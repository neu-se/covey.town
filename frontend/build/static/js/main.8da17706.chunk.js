(this["webpackJsonpcovey-town"]=this["webpackJsonpcovey-town"]||[]).push([[0],{303:function(e,t,n){},305:function(e,t,n){},462:function(e,t,n){},466:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n(0),a=n.n(i),o=n(21),c=n.n(o),s=(n(303),n(10)),l=n.n(s),d=n(4),u=n(15),b=(n(305),n(161)),h=n(258),j=n(555),f=n(543),p=n(52),v=n.n(p),m=n(38),O=n(43),x=n(142),g=n(141),w=n(59),y=n.n(w),k=function(){function e(t,n,r){Object(m.a)(this,e),this.location=void 0,this._id=void 0,this._userName=void 0,this.sprite=void 0,this.label=void 0,this._id=t,this._userName=n,this.location=r}return Object(O.a)(e,[{key:"userName",get:function(){return this._userName}},{key:"id",get:function(){return this._id}}],[{key:"fromServerPlayer",value:function(t){return new e(t._id,t._userName,t.location)}}]),e}(),C=function(){function e(t){Object(m.a)(this,e),this.prefix=t,this.enabled=!1}return Object(O.a)(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"prefixMessage",value:function(t){return"".concat(e.getTimeString(new Date)," [").concat(this.prefix,"]: ").concat(t)}},{key:"info",value:function(e){if(this.enabled){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).info.apply(t,[this.prefixMessage(e)].concat(r))}}},{key:"warn",value:function(e){if(this.enabled){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).warn.apply(t,[this.prefixMessage(e)].concat(r))}}},{key:"error",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).error.apply(t,[this.prefixMessage(e)].concat(r))}},{key:"isEnabled",get:function(){return this.enabled}}],[{key:"getTimeString",value:function(e){var t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0"),i=e.getMilliseconds().toString().padStart(3,"0");return"".concat(t,":").concat(n,":").concat(r,".").concat(i)}}]),e}(),S=n(259),T=n.n(S),P=function(){function e(t){Object(m.a)(this,e),this._axios=void 0;var n=t||Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_TOWNS_SERVICE_URL;v()(n),this._axios=T.a.create({baseURL:n})}return Object(O.a)(e,[{key:"createTown",value:function(){var t=Object(u.a)(l.a.mark((function t(n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._axios.post("/towns",n);case 2:return r=t.sent,t.abrupt("return",e.unwrapOrThrowError(r));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"updateTown",value:function(){var t=Object(u.a)(l.a.mark((function t(n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._axios.patch("/towns/".concat(n.coveyTownID),n);case 2:return r=t.sent,t.abrupt("return",e.unwrapOrThrowError(r,!0));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteTown",value:function(){var t=Object(u.a)(l.a.mark((function t(n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._axios.delete("/towns/".concat(n.coveyTownID,"/").concat(n.coveyTownPassword));case 2:return r=t.sent,t.abrupt("return",e.unwrapOrThrowError(r,!0));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"listTowns",value:function(){var t=Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._axios.get("/towns");case 2:return n=t.sent,t.abrupt("return",e.unwrapOrThrowError(n));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"joinTown",value:function(){var t=Object(u.a)(l.a.mark((function t(n){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._axios.post("/sessions",n);case 2:return r=t.sent,t.abrupt("return",e.unwrapOrThrowError(r));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"unwrapOrThrowError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.data.isOK)return t?{}:(v()(e.data.response),e.data.response);throw new Error("Error processing request: ".concat(e.data.message))}}]),e}(),L=function(){function e(t,n){Object(m.a)(this,e),this.logger=new C("Video"),this.initialisePromise=null,this.teardownPromise=null,this.sessionToken=void 0,this.videoToken=null,this._userName=void 0,this.townsServiceClient=new P,this._coveyTownID=void 0,this._townFriendlyName=void 0,this._isPubliclyListed=void 0,this.pauseGame=function(){},this.unPauseGame=function(){},this._userName=t,this._coveyTownID=n}return Object(O.a)(e,[{key:"setup",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initialisePromise||(this.initialisePromise=new Promise((function(e,n){t.townsServiceClient.joinTown({coveyTownID:t._coveyTownID,userName:t._userName}).then((function(n){t.sessionToken=n.coveySessionToken,t.videoToken=n.providerVideoToken,t._townFriendlyName=n.friendlyName,t._isPubliclyListed=n.isPubliclyListed,e(n)})).catch((function(e){n(e)}))}))),e.abrupt("return",this.initialisePromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"teardown",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.teardownPromise){e.next=7;break}if(!this.initialisePromise){e.next=6;break}n=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.logger.info("Tearing down video client..."),r.logger.info("Tore down video client."),r.initialisePromise=null;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.teardownPromise=this.initialisePromise.then(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:case"end":return e.stop()}}),e)})))).catch(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.logger.warn("Ignoring video initialisation error as we're teraing down anyway.",t),e.next=3,n();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7;break;case 6:return e.abrupt("return",Promise.resolve());case 7:return e.abrupt("return",null!==(t=this.teardownPromise)&&void 0!==t?t:Promise.resolve());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isPubliclyListed",get:function(){return!0===this._isPubliclyListed}},{key:"townFriendlyName",get:function(){return this._townFriendlyName}},{key:"userName",get:function(){return this._userName}},{key:"coveyTownID",get:function(){return this._coveyTownID}}],[{key:"setup",value:function(){var t=Object(u.a)(l.a.mark((function t(n,r){var i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=null,e.video||(e.video=new e(n,r)),t.prev=2,t.next=5,e.video.setup();case 5:(i=t.sent)||(e.video=null),t.next=13;break;case 9:throw t.prev=9,t.t0=t.catch(2),e.video=null,t.t0;case 13:return window.clowdr||(window.clowdr=window.clowdr||{}),window.clowdr.video=e.video,t.abrupt("return",i);case 16:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"teardown",value:function(){var t=Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,null===(n=e.video)||void 0===n?void 0:n.teardown();case 3:return t.prev=3,e.video=null,window.clowdr&&window.clowdr.video&&(window.clowdr.video=null),t.finish(3);case 7:case"end":return t.stop()}}),t,null,[[0,,3,7]])})));return function(){return t.apply(this,arguments)}}()},{key:"instance",value:function(){return e.video}}]),e}();L.video=null;var N=a.a.createContext(null);function E(){var e=Object(i.useContext)(N);return v()(e,"App context should be defined."),e}var I=function(e){Object(x.a)(n,e);var t=Object(g.a)(n);function n(e,r){var i;return Object(m.a)(this,n),(i=t.call(this,"PlayGame")).player=void 0,i.id=void 0,i.players=[],i.cursors=[],i.previouslyCapturedKeys=[],i.lastLocation=void 0,i.ready=!1,i.paused=!1,i.video=void 0,i.emitMovement=void 0,i.video=e,i.emitMovement=r,i}return Object(O.a)(n,[{key:"preload",value:function(){this.load.image("tiles","/assets/tilesets/tuxmon-sample-32px-extruded.png"),this.load.tilemapTiledJSON("map","/assets/tilemaps/tuxemon-town.json"),this.load.atlas("atlas","/assets/atlas/atlas.png","/assets/atlas/atlas.json")}},{key:"updatePlayersLocations",value:function(e){var t=this;if(this.ready){e.forEach((function(e){t.updatePlayerLocation(e)}));var n=this.players.filter((function(t){return!e.find((function(e){return e.id===t.id}))}));n.forEach((function(e){var t;e.sprite&&(e.sprite.destroy(),null===(t=e.label)||void 0===t||t.destroy())})),n.length&&(this.players=this.players.filter((function(e){return!n.find((function(t){return t.id===e.id}))})))}else this.players=e}},{key:"updatePlayerLocation",value:function(e){var t=this.players.find((function(t){return t.id===e.id}));if(!t){var n=e.location;n||(n={rotation:"back",moving:!1,x:0,y:0}),t=new k(e.id,e.userName,n),this.players.push(t)}if(this.id!==t.id&&this.physics&&e.location){var r,i,a=t.sprite;if(!a){a=this.physics.add.sprite(0,0,"atlas","misa-front").setSize(30,40).setOffset(0,24);var o=this.add.text(0,0,t.userName,{font:"18px monospace",color:"#000000",backgroundColor:"#ffffff"});t.label=o,t.sprite=a}if(!a.anims)return;a.setX(e.location.x),a.setY(e.location.y),null===(r=t.label)||void 0===r||r.setX(e.location.x),null===(i=t.label)||void 0===i||i.setY(e.location.y-20),e.location.moving?a.anims.play("misa-".concat(e.location.rotation,"-walk"),!0):(a.anims.stop(),a.setTexture("atlas","misa-".concat(e.location.rotation)))}}},{key:"getNewMovementDirection",value:function(){return this.cursors.find((function(e){var t;return null===(t=e.left)||void 0===t?void 0:t.isDown}))?"left":this.cursors.find((function(e){var t;return null===(t=e.right)||void 0===t?void 0:t.isDown}))?"right":this.cursors.find((function(e){var t;return null===(t=e.down)||void 0===t?void 0:t.isDown}))?"front":this.cursors.find((function(e){var t;return null===(t=e.up)||void 0===t?void 0:t.isDown}))?"back":void 0}},{key:"update",value:function(){if(!this.paused&&this.player&&this.cursors){var e=175,t=this.player.sprite.body.velocity.clone(),n=this.player.sprite.body;n.setVelocity(0);var r=this.getNewMovementDirection();switch(r){case"left":n.setVelocityX(-175),this.player.sprite.anims.play("misa-left-walk",!0);break;case"right":n.setVelocityX(e),this.player.sprite.anims.play("misa-right-walk",!0);break;case"front":n.setVelocityY(e),this.player.sprite.anims.play("misa-front-walk",!0);break;case"back":n.setVelocityY(-175),this.player.sprite.anims.play("misa-back-walk",!0);break;default:this.player.sprite.anims.stop(),t.x<0?this.player.sprite.setTexture("atlas","misa-left"):t.x>0?this.player.sprite.setTexture("atlas","misa-right"):t.y<0?this.player.sprite.setTexture("atlas","misa-back"):t.y>0&&this.player.sprite.setTexture("atlas","misa-front")}this.player.sprite.body.velocity.normalize().scale(e);var i=void 0!==r;this.player.label.setX(n.x),this.player.label.setY(n.y-20),(!this.lastLocation||this.lastLocation.x!==n.x||this.lastLocation.y!==n.y||i&&this.lastLocation.rotation!==r||this.lastLocation.moving!==i)&&(this.lastLocation||(this.lastLocation={x:n.x,y:n.y,rotation:r||"front",moving:i}),this.lastLocation.x=n.x,this.lastLocation.y=n.y,this.lastLocation.rotation=r||"front",this.lastLocation.moving=i,this.emitMovement(this.lastLocation))}}},{key:"create",value:function(){var e=this,t=this.make.tilemap({key:"map"}),n=t.addTilesetImage("tuxmon-sample-32px-extruded","tiles"),r=(t.createLayer("Below Player",n,0,0),t.createLayer("World",n,0,0));r.setCollisionByProperty({collides:!0}),t.createLayer("Above Player",n,0,0).setDepth(10);var i=t.findObject("Objects",(function(e){return"Spawn Point"===e.name})),a=t.createFromObjects("Objects",{name:"transporter"});this.physics.world.enable(a),a.forEach((function(e){var t=e;t.y+=2*t.height,t.setVisible(!1)})),t.filterObjects("Objects",(function(e){return"label"===e.name})).forEach((function(t){t.x&&t.y&&e.add.text(t.x,t.y,t.text.text,{color:"#FFFFFF",backgroundColor:"#000000"})}));var o=this.input.keyboard.createCursorKeys();this.cursors.push(o),this.cursors.push(this.input.keyboard.addKeys({up:y.a.Input.Keyboard.KeyCodes.W,down:y.a.Input.Keyboard.KeyCodes.S,left:y.a.Input.Keyboard.KeyCodes.A,right:y.a.Input.Keyboard.KeyCodes.D},!1)),this.cursors.push(this.input.keyboard.addKeys({up:y.a.Input.Keyboard.KeyCodes.H,down:y.a.Input.Keyboard.KeyCodes.J,left:y.a.Input.Keyboard.KeyCodes.K,right:y.a.Input.Keyboard.KeyCodes.L},!1));var c=this.physics.add.sprite(i.x,i.y,"atlas","misa-front").setSize(30,40).setOffset(0,24),s=this.add.text(i.x,i.y-20,"(You)",{font:"18px monospace",color:"#000000",backgroundColor:"#ffffff"});this.player={sprite:c,label:s},this.physics.add.overlap(c,a,(function(n,r){if(o.space.isDown&&e.player){var i=r.getData("target"),a=t.findObject("Objects",(function(e){return e.id===i}));if(!(a&&a.x&&a.y&&e.lastLocation))throw new Error("Unable to find target object ".concat(a));e.player.sprite.x=a.x,e.player.sprite.y=a.y,e.lastLocation.x=a.x,e.lastLocation.y=a.y,e.emitMovement(e.lastLocation)}})),this.emitMovement({rotation:"front",moving:!1,x:i.x,y:i.y}),this.physics.add.collider(c,r);var l=this.anims;l.create({key:"misa-left-walk",frames:l.generateFrameNames("atlas",{prefix:"misa-left-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),l.create({key:"misa-right-walk",frames:l.generateFrameNames("atlas",{prefix:"misa-right-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),l.create({key:"misa-front-walk",frames:l.generateFrameNames("atlas",{prefix:"misa-front-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1}),l.create({key:"misa-back-walk",frames:l.generateFrameNames("atlas",{prefix:"misa-back-walk.",start:0,end:3,zeroPad:3}),frameRate:10,repeat:-1});var d=this.cameras.main;d.startFollow(this.player.sprite),d.setBounds(0,0,t.widthInPixels,t.heightInPixels),this.add.text(16,16,"Arrow keys to move, space to transport\nCurrent town: ".concat(this.video.townFriendlyName," (").concat(this.video.coveyTownID,")"),{font:"18px monospace",color:"#000000",padding:{x:20,y:10},backgroundColor:"#ffffff"}).setScrollFactor(0).setDepth(30),this.ready=!0,this.players.length&&this.players.forEach((function(t){return e.updatePlayerLocation(t)}))}},{key:"pause",value:function(){this.paused=!0,this.previouslyCapturedKeys=this.input.keyboard.getCaptures(),this.input.keyboard.clearCaptures()}},{key:"resume",value:function(){this.paused=!1,this.input.keyboard.addCapture(this.previouslyCapturedKeys),this.previouslyCapturedKeys=[]}}]),n}(y.a.Scene);function M(){var e=L.instance(),t=E(),n=t.emitMovement,a=t.players,o=Object(i.useState)(),c=Object(d.a)(o,2),s=c[0],l=c[1];Object(i.useEffect)((function(){var t={type:y.a.AUTO,parent:"map-container",minWidth:800,minHeight:600,physics:{default:"arcade",arcade:{gravity:{y:0}}}},r=new y.a.Game(t);if(e){var i=new I(e,n);l(i),r.scene.add("coveyBoard",i,!0),e.pauseGame=function(){i.pause()},e.unPauseGame=function(){i.resume()}}return function(){r.destroy(!0)}}),[e,n]);var u=JSON.stringify(a);return Object(i.useEffect)((function(){null===s||void 0===s||s.updatePlayersLocations(a)}),[a,u,s]),Object(r.jsx)("div",{id:"map-container"})}var D=n(9),V=n(553),A=n(32),F=n(517),R=n(7),B=n(554),z=n(167),_=n(563);function H(e){var t=Object(i.useState)(!!e&&e.isEnabled),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(a(!!e&&e.isEnabled),e){var t=function(){return a(!0)},n=function(){return a(!1)};return e.on("enabled",t),e.on("disabled",n),function(){e.off("enabled",t),e.off("disabled",n)}}return function(){}}),[e]),r}function W(e){var t=Object(i.useState)(null===e||void 0===e?void 0:e.mediaStreamTrack),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(a(null===e||void 0===e?void 0:e.mediaStreamTrack),e){var t=function(){return a(e.mediaStreamTrack)};return e.on("started",t),function(){e.off("started",t)}}return function(){}}),[e]),r}var K,U=0,G=window.AudioContext||window.webkitAudioContext;function Y(e){var t=(K=K||new G).createMediaStreamSource(e),n=K.createAnalyser();return n.smoothingTimeConstant=.2,n.fftSize=256,t.connect(n),n}function q(e){var t=e.audioTrack,n=e.color,a=void 0===n?"white":n,o=Object(i.useRef)(null),c=Object(i.useState)(),s=Object(d.a)(c,2),l=s[0],u=s[1],b=H(t),h=W(t);Object(i.useEffect)((function(){if(t&&h&&b){var e=new MediaStream([h.clone()]),n=function(){return e.getTracks().forEach((function(e){return e.stop()}))};t.on("stopped",n);var r=function(){n(),e=new MediaStream([h.clone()]),u(Y(e))};return u(Y(e)),window.addEventListener("focus",r),function(){n(),window.removeEventListener("focus",r),t.off("stopped",n)}}return function(){}}),[b,h,t]),Object(i.useEffect)((function(){var e=o.current;if(b&&e&&l){var t=new Uint8Array(l.frequencyBinCount),n=Object(_.a)((function(){l.getByteFrequencyData(t);for(var n=0,r=t.length,i=0;i<r;i++)n+=t[i];var a=Math.min(14,Math.max(0,7*Math.log10(n/r/3)));null===e||void 0===e||e.setAttribute("y",String(14-a))}),100);return function(){e.setAttribute("y","14"),n.stop()}}return function(){}}),[b,l]);var j="audio-level-clip-".concat(U++);return b?Object(r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","data-test-audio-indicator":!0,children:[Object(r.jsx)("defs",{children:Object(r.jsx)("clipPath",{id:j,children:Object(r.jsx)("rect",{ref:o,x:"0",y:"14",width:"24",height:"24"})})}),Object(r.jsxs)("g",{fill:"none",fillRule:"evenodd",transform:"translate(.5)",children:[Object(r.jsx)("rect",{clipPath:"url(#".concat(j,")"),width:"5.2",height:"10",x:"9.5",y:"3.5",rx:"6",ry:"3",fill:"#23BF6E"}),Object(r.jsx)("path",{fill:a,strokeWidth:"0",d:"M17.389 10.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V17.09C8.395 16.836 6 14.281 6 11.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM11.944 4c1.566 0 2.834 1.268 2.834 2.833v4.334c0 1.564-1.268 2.833-2.834 2.833-1.564 0-2.833-1.27-2.833-2.833V6.833C9.111 5.268 10.38 4 11.944 4zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334c0 1.012.822 1.833 1.833 1.833 1.013 0 1.834-.82 1.834-1.833V6.833c0-1.013-.82-1.833-1.834-1.833z"})]})]}):Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",transform:"translate(-0.5, 0)","data-test-audio-mute-icon":!0,children:Object(r.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[Object(r.jsx)("path",{fill:a,strokeWidth:"0",d:"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z",transform:"translate(6.5 4)"}),Object(r.jsx)("path",{fill:"red",strokeWidth:"0",d:"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z",transform:"translate(6.5 4)"})]})})}var J=a.a.memo(q);function Q(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"73",height:"73",viewBox:"0 0 73 73",children:Object(r.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[Object(r.jsx)("circle",{cx:"36.5",cy:"36.5",r:"36.5",fill:"#FFF"}),Object(r.jsx)("path",{fill:"#282A2B",strokeLinejoin:"round",d:"M30.973 23.925c-3.162 3.794-3.162 9.886 0 13.68l.262.301c.266.293.548.564.842.812l.192.154v2.95l-6.71 2.397-.213.082c-2.03.834-3.346 2.793-3.346 4.97v2.766c0 .532.431.963.963.963h27.874c.531 0 .962-.431.962-.963V49.27l-.005-.228-.015-.233c-.187-2.092-1.562-3.883-3.539-4.59l-6.71-2.397v-2.95l.192-.154c.393-.33.762-.702 1.104-1.112 3.162-3.795 3.162-9.887 0-13.681-3.25-3.9-8.603-3.9-11.853 0zm10.374 1.232c2.567 3.08 2.567 8.135 0 11.216-.404.484-.85.894-1.328 1.226-.26.18-.414.476-.414.791v4.111c0 .407.255.77.639.907l7.348 2.625c1.314.47 2.213 1.687 2.278 3.077l.004.183v1.781h-25.95l.002-1.804c0-1.394.843-2.65 2.131-3.18l.172-.065 7.327-2.617c.383-.137.639-.5.639-.907v-4.11c0-.316-.155-.612-.415-.792-.478-.332-.924-.742-1.328-1.226-2.567-3.08-2.567-8.135 0-11.216 2.427-2.912 6.248-2.974 8.735-.186l.16.186z"})]})})}var X=Object(V.a)("div")({display:"flex",alignItems:"flex-end","& div":{width:"2px",marginRight:"1px","&:not(:last-child)":{borderRight:"none"}}}),Z=[0,1,2,3,4];function $(e){var t=function(e){var t=Object(i.useState)(e.networkQualityLevel),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){var t=function(e){return a(e)};return a(e.networkQualityLevel),e.on("networkQualityLevelChanged",t),function(){e.off("networkQualityLevelChanged",t)}}),[e]),r}(e.participant);return null===t?null:Object(r.jsx)(X,{children:Z.map((function(e){return Object(r.jsx)("div",{style:{height:"".concat(3*(e+1),"px"),background:t>e?"white":"rgba(255, 255, 255, 0.2)"}},e)}))})}var ee=n(558),te=n(276);function ne(){return Object(r.jsx)(ee.a,{title:"Participant is pinned. Click to un-pin.",placement:"top",children:Object(r.jsx)(te.a,{style:{float:"right",background:"rgba(0, 0, 0, 0.5)",padding:"0.1em",boxSizing:"content-box"},width:"26",height:"26",viewBox:"0 0 26 26",children:Object(r.jsx)("path",{fill:"#FFF",fillRule:"evenodd",strokeWidth:"0",d:"M15.808 4.489c.208-.207.544-.207.75 0l4.953 4.952c.207.207.207.543 0 .75l-1.415 1.415c-.207.208-.543.208-.75 0l-.333-.333-3.007 3.007v2.611c0 .113-.035.222-.1.312l-.055.063-1.06 1.062c-.208.207-.544.207-.751 0l-2.809-2.81-5.992 5.993c-.207.207-.543.207-.75 0-.184-.184-.205-.47-.062-.677l.062-.073 5.991-5.993-2.808-2.808c-.184-.184-.204-.47-.061-.677l.061-.073 1.062-1.061c.1-.1.234-.156.375-.156h2.61l3.007-3.007-.332-.332c-.185-.184-.205-.47-.062-.677l.062-.073zm.376 1.125l-.666.664.333.333c.185.184.205.47.062.677l-.062.074-3.537 3.537c-.1.1-.234.155-.375.155h-2.61l-.531.531 2.803 2.803.005.006.005.005 2.804 2.803.53-.531v-2.61c0-.112.036-.221.102-.311l.054-.064 3.537-3.537c.208-.208.544-.208.75 0l.333.332.664-.666-4.201-4.201z"})})})}function re(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:Object(r.jsx)("path",{fill:"#707578",fillRule:"evenodd",d:"M17.657 6.343c3.124 3.124 3.124 8.19 0 11.314-3.124 3.124-8.19 3.124-11.314 0-3.124-3.124-3.124-8.19 0-11.314 3.124-3.124 8.19-3.124 11.314 0zm-10.444.87c-2.643 2.644-2.643 6.93 0 9.574 2.644 2.643 6.93 2.643 9.574 0 2.57-2.57 2.641-6.693.214-9.35l-.214-.224L16.563 7c-2.657-2.427-6.78-2.356-9.35.214zm4.865.484l.02.003.026.005.041.01c.025.007.045.014.063.021l.043.019c.018.009.036.019.053.03.01.005.02.012.03.02.027.019.053.04.077.063l2.773 2.774c.24.24.24.63 0 .87-.213.214-.545.237-.785.071l-.085-.07-1.719-1.72v5.9c0 .34-.275.615-.615.615-.302 0-.553-.218-.605-.505l-.01-.11-.001-5.9-1.718 1.72c-.24.24-.63.24-.87 0-.214-.215-.238-.546-.072-.786l.072-.085 2.769-2.77.015-.014c.02-.018.04-.035.062-.05l.005-.004.008-.006c.027-.018.055-.034.085-.048l.034-.015.059-.02.032-.008c.021-.005.044-.008.068-.011l.038-.003H12.025l.027.002.026.002z"})})}function ie(e){var t=Object(i.useState)(e&&e.isSwitchedOff),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(a(e&&e.isSwitchedOff),e){var t=function(){return a(!0)},n=function(){return a(!1)};return e.on("switchedOff",t),e.on("switchedOn",n),function(){e.off("switchedOff",t),e.off("switchedOn",n)}}return function(){}}),[e]),!!r}var ae=n(20);function oe(e){var t=Object(i.useState)([]),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){a(Array.from(e.tracks.values()));var t=function(e){return a((function(t){return[].concat(Object(ae.a)(t),[e])}))},n=function(e){return a((function(t){return t.filter((function(t){return t!==e}))}))};return e.on("trackPublished",t),e.on("trackUnpublished",n),function(){e.off("trackPublished",t),e.off("trackUnpublished",n)}}),[e]),r}function ce(e){var t=Object(i.useState)(e&&e.track),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(a(e&&e.track),e){var t=function(){return a(null)};return e.on("subscribed",a),e.on("unsubscribed",t),function(){e.off("subscribed",a),e.off("unsubscribed",t)}}return function(){}}),[e]),r}function se(e){var t=Object(i.useState)(!1),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){var t=function(){return a(!0)},n=function(){return a(!1)};return n(),e.on("reconnecting",t),e.on("reconnected",n),function(){e.off("reconnecting",t),e.off("reconnected",n)}}),[e]),r}var le=Object(F.a)((function(e){return Object(B.a)({container:{position:"relative",display:"flex",alignItems:"center",height:0,overflow:"hidden","& video":{filter:"none",objectFit:"contain !important"},paddingTop:"calc(".concat(56.25,"% - ").concat(3,"px)"),border:"".concat(3,"px solid black"),background:"black"},notContainedInGrid:Object(D.a)({},e.breakpoints.down("sm"),{height:e.sidebarMobileHeight,width:"".concat(16*e.sidebarMobileHeight/9,"px"),marginRight:"8px",marginBottom:"0",fontSize:"10px",paddingTop:"".concat(e.sidebarMobileHeight-2,"px")}),innerContainer:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},infoContainer:{position:"absolute",zIndex:2,display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",width:"100%",background:"transparent",top:0},avatarContainer:Object(D.a)({display:"flex",alignItems:"center",justifyContent:"center",background:"black",position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:1},e.breakpoints.down("sm"),{"& svg":{transform:"scale(0.7)"}}),reconnectingContainer:{position:"absolute",top:0,right:0,bottom:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(40, 42, 43, 0.75)",zIndex:1},screenShareIconContainer:{background:"rgba(0, 0, 0, 0.5)",padding:"0.18em 0.3em",marginRight:"0.3em",display:"flex","& path":{fill:"white"}},identity:{background:"rgba(0, 0, 0, 0.5)",color:"white",padding:"0.18em 0.3em",margin:0,display:"flex",alignItems:"center"},infoRowBottom:{display:"flex",justifyContent:"space-between",position:"absolute",bottom:0,left:0},networkQualityContainer:{width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.5)"},typeography:Object(D.a)({color:"white"},e.breakpoints.down("sm"),{fontSize:"0.75rem"}),hideParticipant:{display:"none"},cursorPointer:{cursor:"pointer"},highlightParticipant:{border:"".concat(3,"px solid ").concat(e.palette.primary.main)}})}));function de(e){var t,n=e.participant,o=e.profile,c=e.onClick,s=e.isSelected,l=e.children,u=e.isLocalParticipant,b=e.hideParticipant,h=e.slot,j=e.insideGrid,f=e.highlight,p=oe(n),v=p.find((function(e){return"audio"===e.kind})),m=p.find((function(e){return e.trackName.includes("camera")})),O=Boolean(m),x=p.find((function(e){return e.trackName.includes("screen")})),g=ie(ce(m)),w=ce(v),y=se(n),k=le(),C=a.a.useState(null),S=Object(d.a)(C,2),T=S[0],P=S[1],L=Object(i.useCallback)((function(e){P(e.currentTarget)}),[]),N=Object(i.useCallback)((function(){P(null)}),[]);Boolean(T);return Object(r.jsxs)("div",{className:Object(R.a)(k.container,(t={},Object(D.a)(t,k.hideParticipant,b),Object(D.a)(t,k.cursorPointer,Boolean(c)),Object(D.a)(t,k.notContainedInGrid,!j),Object(D.a)(t,k.highlightParticipant,f),t),void 0!==h?"area-".concat(h):void 0),onClick:c,"data-cy-participant":n.identity,children:[Object(r.jsxs)("div",{className:k.infoContainer,children:[Object(r.jsx)("div",{className:k.networkQualityContainer,children:Object(r.jsx)($,{participant:n})}),Object(r.jsxs)("div",{className:k.infoRowBottom,children:[x&&Object(r.jsx)("span",{className:k.screenShareIconContainer,children:Object(r.jsx)(re,{})}),Object(r.jsxs)("a",{className:k.identity,id:o?"".concat(o.id,"-mouse-over-popover"):void 0,"aria-haspopup":"true",onMouseEnter:L,onMouseLeave:N,href:"/profile/".concat(o?o.id:""),target:"_blank",rel:"noopener noreferrer",children:[Object(r.jsx)(J,{audioTrack:w}),Object(r.jsxs)(z.a,{variant:"body1",className:k.typeography,component:"span",children:[o?o.displayName:"",u&&" (You)"]})]})]}),Object(r.jsx)("div",{children:s&&Object(r.jsx)(ne,{})})]}),Object(r.jsxs)("div",{className:k.innerContainer,children:[(!O||g)&&Object(r.jsx)("div",{className:k.avatarContainer,children:Object(r.jsx)(Q,{})}),y&&Object(r.jsx)("div",{className:k.reconnectingContainer,children:Object(r.jsx)(z.a,{variant:"body1",className:k.typeography,children:"Reconnecting..."})}),l]})]})}var ue=n(34),be=n(264),he=n.n(be),je="undefined"!==typeof navigator&&"string"===typeof navigator.userAgent&&/Mobile/.test(navigator.userAgent);function fe(e){if(!he()(e))return e;var t={};for(var n in e){var r=e[n];"undefined"!==typeof r&&(t[n]=fe(r))}return t}var pe={trackSwitchOffMode:void 0,dominantSpeakerPriority:"standard",bandwidthProfileMode:"collaboration",maxTracks:je?"5":"10",maxAudioBitrate:"16000",renderDimensionLow:"low",renderDimensionStandard:"960p",renderDimensionHigh:"wide1080p"},ve=function(){var e={};for(var t in pe)e[t]=t;return e}();function me(e,t){return Object(ue.a)(Object(ue.a)({},e),{},Object(D.a)({},t.name,"default"===t.value?void 0:t.value))}var Oe=Object(i.createContext)(null);function xe(e){var t,n=Object(i.useState)(null),a=Object(d.a)(n,2),o=a[0],c=a[1],s=Object(i.useState)(!1),l=Object(d.a)(s,2),u=l[0],b=l[1],h=Object(i.useState)("default"),j=Object(d.a)(h,2),f=j[0],p=j[1],v=Object(i.useReducer)(me,pe),m=Object(d.a)(v,2),O=m[0],x=m[1],g={error:o,setError:c,isFetching:u,activeSinkId:f,setActiveSinkId:p,settings:O,dispatchSetting:x,toggleWidth:null!==(t=e.toggleWidth)&&void 0!==t?t:function(){},preferredMode:e.preferredMode,highlightedProfiles:e.highlightedProfiles};return Object(r.jsx)(Oe.Provider,{value:Object(ue.a)(Object(ue.a)({},g),{},{getToken:function(e){return b(!0),g.getToken(e).then((function(e){return b(!1),e})).catch((function(e){return c(e),b(!1),Promise.reject(e)}))}}),children:e.children})}function ge(){var e=Object(i.useContext)(Oe);if(!e)throw new Error("useAppState must be used within the AppStateProvider");return e}function we(e){var t=e.track,n=ge().activeSinkId,r=Object(i.useRef)();return Object(i.useEffect)((function(){return r.current=t.attach(),r.current.setAttribute("data-cy-audio-track-name",t.name),document.body.appendChild(r.current),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t]),Object(i.useEffect)((function(){var e,t;null===(e=r.current)||void 0===e||null===(t=e.setSinkId)||void 0===t||t.call(e,n)}),[n]),null}var ye=Object(V.a)("video")({maxWidth:"100%",maxHeight:"100%",width:"100%",objectFit:"contain"});function ke(e){var t,n,a=e.track,o=e.isLocal,c=e.priority,s=Object(i.useRef)(null),l=W(a),u=function(e){var t=Object(i.useState)(null===e||void 0===e?void 0:e.dimensions),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(a(null===e||void 0===e?void 0:e.dimensions),e){var t=function(e){return a(null===e||void 0===e?void 0:e.dimensions)};return e.on("dimensionsChanged",t),function(){e.off("dimensionsChanged",t)}}return function(){}}),[e]),r}(a),b=(null!==(t=null===u||void 0===u?void 0:u.height)&&void 0!==t?t:0)>(null!==(n=null===u||void 0===u?void 0:u.width)&&void 0!==n?n:0);Object(i.useEffect)((function(){var e=s.current;return e.muted=!0,a.setPriority&&c&&a.setPriority(c),a.attach(e),function(){a.detach(e),a.setPriority&&c&&a.setPriority(null)}}),[a,c]);var h="environment"!==(null===l||void 0===l?void 0:l.getSettings().facingMode),j={transform:o&&h?"rotateY(180deg)":"",objectFit:b||a.name.includes("screen")?"contain":"cover"};return Object(r.jsx)(ye,{ref:s,style:j})}function Ce(e){var t=e.publication,n=e.isLocalParticipant,i=e.videoOnly,a=e.videoPriority,o=ce(t);if(!o)return null;switch(o.kind){case"video":return Object(r.jsx)(ke,{track:o,priority:a,isLocal:o.name.includes("camera")&&n});case"audio":return i?null:Object(r.jsx)(we,{track:o});default:return null}}function Se(e){var t,n=e.participant,i=e.videoOnly,a=e.enableScreenShare,o=e.videoPriority,c=e.isLocalParticipant,s=oe(n);return t=a&&s.some((function(e){return e.trackName.includes("screen")}))?s.filter((function(e){return!e.trackName.includes("camera")})):s.filter((function(e){return!e.trackName.includes("screen")})),Object(r.jsx)(r.Fragment,{children:t.map((function(e){return Object(r.jsx)(Ce,{publication:e,participant:n,isLocalParticipant:c,videoOnly:i,videoPriority:o},e.kind)}))})}function Te(e){var t=e.participant,n=e.profile,i=e.videoOnly,a=e.enableScreenShare,o=e.onClick,c=e.isSelected,s=e.isLocalParticipant,l=e.hideParticipant,d=e.slot,u=e.insideGrid,b=e.highlight;return Object(r.jsx)(de,{participant:t,profile:n,onClick:o,isSelected:c,isLocalParticipant:s,hideParticipant:l,slot:d,insideGrid:u,highlight:b,children:Object(r.jsx)(Se,{participant:t,videoOnly:i,enableScreenShare:a,isLocalParticipant:s})})}var Pe=Object(i.createContext)(null);function Le(){var e=Object(i.useContext)(Pe),t=Object(d.a)(e,2);return[t[0],t[1]]}function Ne(e){var t=e.room,n=e.children,a=Object(i.useState)(null),o=Object(d.a)(a,2),c=o[0],s=o[1];return Object(i.useEffect)((function(){var e=function(){return s(null)};return t.on("disconnected",e),function(){t.off("disconnected",e)}}),[t]),Object(r.jsx)(Pe.Provider,{value:[c,function(e){return s((function(t){return t===e?null:e}))}],children:n})}var Ee=function(){function e(){Object(m.a)(this,e)}return Object(O.a)(e,null,[{key:"twilioVideoCameraEnabled",get:function(){return"true"===localStorage.getItem(e.twilioVideoCameraEnabledKey)},set:function(t){null!==t?localStorage.setItem(e.twilioVideoCameraEnabledKey,!0===t?"true":"false"):localStorage.removeItem(e.twilioVideoCameraEnabledKey)}},{key:"twilioVideoMicEnabled",get:function(){return"true"===localStorage.getItem(e.twilioVideoMicEnabledKey)},set:function(t){null!==t?localStorage.setItem(e.twilioVideoMicEnabledKey,!0===t?"true":"false"):localStorage.removeItem(e.twilioVideoMicEnabledKey)}},{key:"twilioVideoLastCamera",get:function(){return localStorage.getItem(e.twilioVideoLastCameraKey)},set:function(t){t?localStorage.setItem(e.twilioVideoLastCameraKey,t):localStorage.removeItem(e.twilioVideoLastCameraKey)}},{key:"twilioVideoLastMic",get:function(){return localStorage.getItem(e.twilioVideoLastMicKey)},set:function(t){t?localStorage.setItem(e.twilioVideoLastMicKey,t):localStorage.removeItem(e.twilioVideoLastMicKey)}}]),e}();function Ie(){var e=Xe(),t=e.room.localParticipant,n=e.localVideoTrack,r=e.getLocalVideoTrack,a=e.removeLocalVideoTrack,o=Object(i.useState)(!1),c=Object(d.a)(o,2),s=c[0],b=c[1],h=Object(i.useCallback)((function(){if(n){var e;Ee.twilioVideoLastCamera=null!==(e=n.mediaStreamTrack.getSettings().deviceId)&&void 0!==e?e:null;var r=null===t||void 0===t?void 0:t.unpublishTrack(n);null===t||void 0===t||t.emit("trackUnpublished",r),a()}}),[t,a,n]),j=Object(i.useCallback)(Object(u.a)(l.a.mark((function e(){var i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=31;break}if(!n){e.next=6;break}h(),Ee.twilioVideoCameraEnabled=!1,e.next=31;break;case 6:if(b(!0),e.prev=7,Ee.twilioVideoCameraEnabled=!0,!(i=Ee.twilioVideoLastCamera)){e.next=16;break}return e.next=13,r({deviceId:{exact:i}});case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,r();case 18:e.t0=e.sent;case 19:a=e.t0,null===t||void 0===t||t.publishTrack(a,{priority:"low"}),e.next=28;break;case 23:throw e.prev=23,e.t1=e.catch(7),console.log(e.t1.name),"NotReadableError"!==(null===e.t1||void 0===e.t1?void 0:e.t1.name)&&"OverconstrainedError"!==(null===e.t1||void 0===e.t1?void 0:e.t1.name)||(Ee.twilioVideoLastCamera=null),e.t1;case 28:return e.prev=28,b(!1),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[7,23,28,31]])}))),[s,n,h,r,t]);return{isEnabled:!!n,toggleVideoEnabled:j,stopVideo:h}}function Me(){var e=Xe().room,t=Ie(),n=t.isEnabled,r=t.toggleVideoEnabled,a=Object(i.useRef)(!1);return Object(i.useEffect)((function(){if(je){var e=function(){"hidden"===document.visibilityState&&n?(a.current=!0,r()):a.current&&(a.current=!1,r())};return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}return function(){}}),[n,e,r]),null}Ee.twilioVideoCameraEnabledKey="twilioVideoCameraEnabled",Ee.twilioVideoMicEnabledKey="twilioVideoMicEnabled",Ee.twilioVideoLastCameraKey="twilioVideoLastCamera",Ee.twilioVideoLastMicKey="twilioVideoLastMic";var De=n(76),Ve=n.n(De),Ae=n(265);function Fe(){var e=Object(i.useState)([]),t=Object(d.a)(e,2),n=t[0],r=t[1];return Object(i.useEffect)((function(){var e=function(){return navigator.mediaDevices.enumerateDevices().then((function(e){return r(e)}))};return navigator.mediaDevices.addEventListener("devicechange",e),e(),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[]),n}function Re(){return Fe().filter((function(e){return"audioinput"===e.kind}))}function Be(){return Fe().filter((function(e){return"videoinput"===e.kind}))}function ze(){return Re().length>0}function _e(){return Be().length>0}var He={width:1280,height:720,frameRate:24};var We=n(28),Ke=n.n(We);function Ue(){var e=Xe().room,t=Object(i.useState)(),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if("connected"===e.state){var t=function(){a(Array.from(e.participants.values()).concat(e.localParticipant).find((function(e){return Array.from(e.tracks.values()).find((function(e){return e.trackName.includes("screen")}))})))};return t(),e.on("trackPublished",t),e.on("trackUnpublished",t),e.on("participantDisconnected",t),e.localParticipant.on("trackPublished",t),e.localParticipant.on("trackUnpublished",t),function(){e.off("trackPublished",t),e.off("trackUnpublished",t),e.off("participantDisconnected",t),e.localParticipant.off("trackPublished",t),e.localParticipant.off("trackUnpublished",t)}}return function(){}}),[e]),r}window.TwilioVideo=Ve.a;var Ge=Object(i.createContext)(null);function Ye(){return Object(i.useContext)(Ge)}function qe(e){var t=e.children,n=Le(),i=Object(d.a)(n,1)[0],a=Ue();return Object(r.jsx)(Ge.Provider,{value:i||a?"presenting":"not presenting",children:t})}var Je=Object(i.createContext)(null);function Qe(e){var t=e.options,n=e.children,a=e.onError,o=void 0===a?function(){}:a,c=e.onDisconnect,s=void 0===c?function(){}:c,b=function(e){console.log("ERROR: ".concat(e.message),e),o(e)},h=function(){var e=Object(i.useState)(),t=Object(d.a)(e,2),n=t[0],r=t[1],a=Object(i.useState)(),o=Object(d.a)(a,2),c=o[0],s=o[1],b=Object(i.useState)(!1),h=Object(d.a)(b,2),j=h[0],f=h[1],p=ze(),v=_e(),m=Object(i.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){var n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},t&&(n.deviceId={exact:t}),console.log("Running getLocalAudioTrack"),e.next=5,Ve.a.createLocalAudioTrack(n);case 5:return i=e.sent,r(i),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),O=Object(i.useCallback)((function(e){var t=Object(ue.a)({width:640,height:480,frameRate:24,name:"camera-".concat(Date.now())},e);return Ve.a.createLocalVideoTrack(t).then((function(e){return s(e),e}))}),[]),x=Object(i.useCallback)((function(){c&&(c.stop(),s(void 0))}),[c]),g=Object(i.useCallback)((function(){n&&(n.stop(),r(void 0))}),[n]),w=new(Object(Ae.a)())("getAudioAndVideoTracks");return{audioTrack:n,videoTrack:c,getLocalVideoTrack:O,getLocalAudioTrack:m,isAcquiringLocalTracks:j,removeLocalVideoTrack:x,removeLocalAudioTrack:g,getAudioAndVideoTracks:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.run(Object(u.a)(l.a.mark((function e(){var t,i,a,o,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.lock(),e.prev=1,p||v){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(!n&&!c){e.next=6;break}return e.abrupt("return",Promise.resolve());case 6:return console.log("Running getAudioAndVideoTracks"),f(!0),e.next=10,Ve.a.createLocalTracks({video:v&&Object(ue.a)(Object(ue.a)({},He),{},{name:"camera-".concat(Date.now()),deviceId:null!==(t=Ee.twilioVideoLastCamera)&&void 0!==t?t:void 0}),audio:p&&{deviceId:null!==(i=Ee.twilioVideoLastMic)&&void 0!==i?i:void 0}});case 10:a=e.sent,o=a.find((function(e){return"video"===e.kind})),d=a.find((function(e){return"audio"===e.kind})),o&&(console.log("Running getAudioAndVideoTracks:setVideoTrack"),s(o)),d&&(console.log("Running getAudioAndVideoTracks:setAudioTrack"),r(d));case 15:return e.prev=15,f(!1),w.unlock(),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[1,,15,19]])}))),(function(){})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}(),j=h.audioTrack,f=h.videoTrack,p=h.getLocalVideoTrack,v=h.getLocalAudioTrack,m=h.isAcquiringLocalTracks,O=h.removeLocalVideoTrack,x=h.removeLocalAudioTrack,g=h.getAudioAndVideoTracks,w=function(e,t,n,r){var a=Object(i.useState)(new Ke.a),o=Object(d.a)(a,2),c=o[0],s=o[1],l=Object(i.useState)(!1),u=Object(d.a)(l,2),b=u[0],h=u[1],j=Object(i.useRef)(r);return Object(i.useEffect)((function(){j.current=r}),[r]),{room:c,isConnecting:b,connect:Object(i.useCallback)((function(r){h(!0);var i=[e,t].filter((function(e){return void 0!==e}));return Ve.a.connect(r,Object(ue.a)(Object(ue.a)({},j.current),{},{tracks:i})).then((function(e){s(e);var t=function(){return e.disconnect()};e.setMaxListeners(15),e.once("disconnected",(function(){setTimeout((function(){return s(new Ke.a)})),window.removeEventListener("beforeunload",t),je&&window.removeEventListener("pagehide",t)})),window.twilioRoom=e,e.localParticipant.videoTracks.forEach((function(e){return e.setPriority("low")})),h(!1),window.addEventListener("beforeunload",t),je&&window.addEventListener("pagehide",t)}),(function(e){n(e),h(!1)}))}),[e,t,n])}}(j,f,b,t),y=w.room,k=w.isConnecting,C=w.connect;!function(e,t){Object(i.useEffect)((function(){var n=function(e,n){n&&t(n)};return e.on("disconnected",n),function(){e.off("disconnected",n)}}),[e,t])}(y,o),function(e,t){var n=e.localParticipant;Object(i.useEffect)((function(){return n?(n.on("trackPublicationFailed",t),function(){n.off("trackPublicationFailed",t)}):function(){}}),[n,t])}(y,o),function(e,t){Object(i.useEffect)((function(){return e.on("disconnected",t),function(){e.off("disconnected",t)}}),[e,t])}(y,s);var S=function(e,t){var n=Object(i.useState)(!1),r=Object(d.a)(n,2),a=r[0],o=r[1],c=Object(i.useRef)(null),s=Object(i.useCallback)((function(){navigator.mediaDevices.getDisplayMedia({audio:!1,video:{frameRate:10,height:1080,width:1920}}).then((function(n){var r=n.getTracks()[0];e.localParticipant.publishTrack(r,{name:"screen",priority:"low"}).then((function(t){c.current=function(){e.localParticipant.unpublishTrack(r),e.localParticipant.emit("trackUnpublished",t),r.stop(),o(!1)},r.onended=c.current,o(!0)})).catch(t)})).catch((function(e){"AbortError"!==e.name&&"NotAllowedError"!==e.name&&t(e)}))}),[e,t]),l=Object(i.useCallback)((function(){a?c.current():s()}),[a,s,c]);return[a,l]}(y,o),T=Object(d.a)(S,2),P=T[0],L=T[1];return Object(r.jsxs)(Je.Provider,{value:{room:y,localAudioTrack:j,localVideoTrack:f,isConnecting:k,onError:b,onDisconnect:s,getLocalVideoTrack:p,getLocalAudioTrack:v,connect:C,isAcquiringLocalTracks:m,removeLocalVideoTrack:O,removeLocalAudioTrack:x,isSharingScreen:P,toggleScreenShare:L,getAudioAndVideoTracks:g},children:[Object(r.jsx)(Ne,{room:y,children:Object(r.jsx)(qe,{children:n})}),Object(r.jsx)(Me,{})]})}function Xe(){var e=Object(i.useContext)(Je);if(!e)throw new Error("useVideoContext must be used within a VideoProvider");return e}function Ze(){var e=Le(),t=Object(d.a)(e,1)[0],n=Ue(),r=Xe().room.localParticipant;return(n!==r?n:null)||t||r}var $e=a.a.createContext({nearbyPlayers:[]});function et(e){var t,n=Xe().room.localParticipant,a=function(){var e=Xe().room,t=Object(i.useState)(Array.from(e.participants.values()).map((function(e,t){return{participant:e,slot:t+1}}))),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){var t=function(e){return a((function(t){for(var n=0,r=t.sort((function(e,t){return e.slot<t.slot?-1:e.slot===t.slot?0:1}));n<r.length&&n+1===r[n].slot;)n++;return[].concat(Object(ae.a)(t),[{participant:e,slot:n+1}])}))},n=function(e){return a((function(t){return t.filter((function(t){return t.participant!==e}))}))};return e.on("participantConnected",t),e.on("participantDisconnected",n),function(){e.off("participantConnected",t),e.off("participantDisconnected",n)}}),[e]),r}(),o=Le(),c=Object(d.a)(o,2),s=c[0],l=c[1],u=Ue(),b=Ze(),h=function(){var e=Object(i.useContext)($e);return v()(e,"App context should be defined."),e}().nearbyPlayers,j=(t="fullwidth",Object(F.a)((function(e){var n;return Object(B.a)({container:Object(D.a)({padding:"2em",overflowY:"auto",background:"rgb(79, 83, 85)",gridArea:"1 / 2 / 1 / 3",zIndex:5},e.breakpoints.down("sm"),{gridArea:"2 / 1 / 3 / 3",overflowY:"initial",overflowX:"auto",display:"flex",padding:"8px"}),transparentBackground:{background:"transparent"},scrollContainer:Object(D.a)({},e.breakpoints.down("sm"),{display:"flex"}),gridContainer:Object(D.a)({gridArea:"1 / 1 / 1 / 3",overflowX:"hidden",overflowY:"auto"},e.breakpoints.down("sm"),{gridArea:"1 / 1 / 3 / 1"}),gridInnerContainer:(n={display:"grid",gridTemplateColumns:"sidebar"===t?"1fr":"1fr 1fr 1fr 1fr",gridAutoRows:"1fr"},Object(D.a)(n,e.breakpoints.down("md"),{gridTemplateColumns:"sidebar"===t?"1fr":"1fr 1fr 1fr"}),Object(D.a)(n,e.breakpoints.down("sm"),{gridTemplateColumns:"sidebar"===t?"1fr":"1fr 1fr"}),Object(D.a)(n,e.breakpoints.down("xs"),{gridTemplateColumns:"1fr"}),n)})}))());var f=Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(Te,{participant:n,isLocalParticipant:!0,insideGrid:e.gridView,slot:0}),a.filter((function(e){return h.find((function(t){return t.id==e.participant.identity}))})).sort((function(e,t){return e.slot<t.slot?-1:e.slot===t.slot?0:1})).map((function(t){var n=t.participant,i=n===b&&n!==u&&!(n===s)&&a.length>1,o=h.find((function(e){return e.id==t.participant.identity})),c={displayName:o?o.userName:"unknown",id:t.participant.identity};return Object(r.jsx)(Te,{participant:n,profile:c,isSelected:n===s,onClick:function(){return l(n)},hideParticipant:i,slot:t.slot,insideGrid:e.gridView},n.sid)}))]});return e.gridView?Object(r.jsx)("main",{className:Object(R.a)(j.gridContainer,Object(D.a)({},j.transparentBackground,!0),"participants-grid-container",{"single-column":!1}),children:Object(r.jsx)("div",{className:j.gridInnerContainer,children:f})}):Object(r.jsx)("aside",{className:Object(R.a)(j.container,Object(D.a)({},j.transparentBackground,!0)),children:Object(r.jsx)("div",{className:j.scrollContainer,children:f})})}var tt=Object(F.a)((function(e){return{container:{position:"relative",display:"flex",alignItems:"center",cursor:"pointer"},identity:{background:"rgba(0, 0, 0, 0.5)",color:"white",padding:"0.1em 0.3em 0.1em 0",fontSize:"1.2em",display:"inline-flex","& svg":{marginLeft:"0.3em"}},infoContainer:{position:"absolute",zIndex:2,height:"100%",width:"100%"},reconnectingContainer:{position:"absolute",top:0,right:0,bottom:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(40, 42, 43, 0.75)",zIndex:1},fullWidth:Object(D.a)({gridArea:"1 / 1 / 2 / 3"},e.breakpoints.down("sm"),{gridArea:"1 / 1 / 3 / 3"}),avatarContainer:{display:"flex",alignItems:"center",justifyContent:"center",background:"black",position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:1,"& svg":{transform:"scale(2)"}}}}));function nt(e){var t=e.participant,n=e.children,a=tt(),o=Xe().room.localParticipant===t,c=oe(t),s=c.find((function(e){return e.trackName.includes("camera")})),l=c.find((function(e){return e.trackName.includes("screen")})),u=Le()[1],b=ce(l||s),h=Boolean(b),j=ce(c.find((function(e){return"audio"===e.kind}))),f=ie(b),p=se(t),v=Object(i.useState)(null),m=Object(d.a)(v,2),O=m[0];m[1];return Object(r.jsxs)("div",{"data-cy-main-participant":!0,"data-cy-participant":t.identity,className:Object(R.a)(a.container,Object(D.a)({},a.fullWidth,!1)),onClick:function(){return u(t)},children:[Object(r.jsx)("div",{className:a.infoContainer,children:Object(r.jsxs)("div",{className:a.identity,children:[Object(r.jsx)(J,{audioTrack:j}),Object(r.jsxs)(z.a,{variant:"body1",color:"inherit",children:[O?O.displayName:"",o&&" (You)",l&&" - Screen"]})]})}),(!h||f)&&Object(r.jsx)("div",{className:a.avatarContainer,children:Object(r.jsx)(Q,{})}),p&&Object(r.jsx)("div",{className:a.reconnectingContainer,children:Object(r.jsx)(z.a,{variant:"body1",style:{color:"white"},children:"Reconnecting..."})}),n]})}function rt(){var e=Ze(),t=Xe().room.localParticipant,n=Le(),i=Object(d.a)(n,1)[0],a=Ue(),o=e!==i&&e!==a||e===t?null:"high";return Object(r.jsx)(nt,{participant:e,children:Object(r.jsx)(Se,{participant:e,videoOnly:!0,enableScreenShare:e!==t,videoPriority:o,isLocalParticipant:e===t})})}var it=Object(F.a)((function(e){return{container:function(t){return Object(D.a)({position:"relative",height:"100%",display:"grid",gridTemplateColumns:"sidebar"===t.preferredMode&&"not presenting"===t.presenting?"1fr":"1fr ".concat(e.sidebarWidth,"px"),gridTemplateRows:"100%"},e.breakpoints.down("sm"),{gridTemplateColumns:"100%",gridTemplateRows:"1fr ".concat(e.sidebarMobileHeight+26,"px"),overflow:"auto"})}}}));function at(){var e=ge().preferredMode,t=Ye(),n=it({preferredMode:e,presenting:t});return Object(r.jsxs)("div",{className:Object(R.a)(n.container),children:["presenting"===t?Object(r.jsx)(rt,{}):Object(r.jsx)(r.Fragment,{}),Object(r.jsx)(et,{gridView:"not presenting"===t})]})}var ot=n(518),ct=n(519),st=n(549),lt=Object(F.a)((function(e){return Object(B.a)({button:{background:e.brand,color:"white","&:hover":{background:"#600101"}}})}));function dt(e){var t=lt(),n=Xe().room;return Object(r.jsx)(ot.a,{onClick:Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.disconnect();case 2:case"end":return e.stop()}}),e)}))),className:Object(R.a)(t.button,e.className),"data-cy-disconnect":!0,children:"Disconnect"})}function ut(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"24",viewBox:"0 0 25 24",children:Object(r.jsx)("g",{fill:"none",fillRule:"evenodd",children:Object(r.jsx)("g",{fill:"#707578",children:Object(r.jsx)("path",{d:"M12 3.5c4.694 0 8.5 3.806 8.5 8.5s-3.806 8.5-8.5 8.5-8.5-3.806-8.5-8.5S7.306 3.5 12 3.5zm0 1c-4.142 0-7.5 3.358-7.5 7.5 0 4.142 3.358 7.5 7.5 7.5 4.142 0 7.5-3.358 7.5-7.5 0-4.142-3.358-7.5-7.5-7.5zm1.367 3.429C14.959 8.492 16.1 10.215 16.1 12c0 1.16-.481 2.294-1.256 3.1h.356c.245 0 .45.177.492.41l.008.09c0 .245-.177.45-.41.492l-.09.008h-2.008l-.048-.003-.034-.005c-.088-.017-.167-.055-.233-.11l-.06-.06c-.037-.044-.067-.096-.087-.151l-.001-.004-.012-.04c-.004-.012-.007-.024-.009-.037v-.005c-.005-.024-.006-.042-.007-.06L12.7 13.6c0-.276.224-.5.5-.5.245 0 .45.177.492.41l.008.09v1.176c.833-.6 1.4-1.676 1.4-2.776 0-1.373-.886-2.71-2.067-3.129-.26-.092-.396-.377-.304-.638.092-.26.378-.396.638-.304zm-2.559-.03c.03.001.058.004.086.01l.062.016.018.006c.04.015.075.034.108.056.086.059.152.143.188.242l.001.004.008.025c.006.017.01.034.013.052l.008.09v2c0 .276-.224.5-.5.5-.245 0-.45-.177-.492-.41l-.008-.09V9.224c-.833.6-1.4 1.676-1.4 2.776 0 1.373.886 2.71 2.067 3.129.26.092.396.377.304.638-.092.26-.378.396-.638.304C9.041 15.508 7.9 13.785 7.9 12c0-1.16.481-2.294 1.255-3.1H8.8c-.245 0-.45-.177-.492-.41L8.3 8.4c0-.245.177-.45.41-.492L8.8 7.9h2.008z",transform:"translate(-233 -689) translate(-1 673) translate(37 16) translate(197.298)"})})})})}function bt(){var e=Xe().localVideoTrack,t=Object(i.useState)(null),n=Object(d.a)(t,2),a=n[0],o=n[1],c=W(e),s=Be();Object(i.useEffect)((function(){(null===c||void 0===c?void 0:c.getSettings().facingMode)&&null===a&&o(!0)}),[c,a]);var l=Object(i.useCallback)((function(){if(e){var t="user"===(null===c||void 0===c?void 0:c.getSettings().facingMode)?"environment":"user";e.restart(Object(ue.a)(Object(ue.a)({},He),{},{facingMode:t}))}}),[c,e]);return a&&s.length>1?Object(r.jsx)(ot.a,{onClick:l,disabled:!e,startIcon:Object(r.jsx)(ut,{}),children:"Flip Camera"}):null}var ht=n(560),jt=n(528),ft=n(550),pt=n(524),vt=n(525),mt=n(526),Ot=n(527),xt=n(520),gt=n(547);function wt(){var e=Re(),t=Xe().localAudioTrack,n=W(t),a=null===n||void 0===n?void 0:n.getSettings().deviceId,o=Object(i.useState)(Ee.twilioVideoLastMic),c=Object(d.a)(o,2),s=c[0],l=c[1],u=Object(i.useCallback)((function(e){Ee.twilioVideoLastMic=e,l(e)}),[]);return Object(r.jsxs)("div",{children:[Object(r.jsx)(z.a,{variant:"subtitle2",gutterBottom:!0,children:"Audio Input"}),Object(r.jsxs)(ct.a,{container:!0,alignItems:"center",justify:"space-between",children:[Object(r.jsx)("div",{className:"inputSelect",children:e.length>1?Object(r.jsx)(xt.a,{fullWidth:!0,children:Object(r.jsx)(gt.a,{onChange:function(e){return n=e.target.value,u(n),void(null===t||void 0===t||t.restart({deviceId:{exact:n}}));var n},value:a||s,variant:"outlined",children:e.map((function(e){return Object(r.jsx)(ht.a,{value:e.deviceId,children:e.label},e.deviceId)}))})}):Object(r.jsx)(z.a,{children:(null===t||void 0===t?void 0:t.mediaStreamTrack.label)||"No Local Audio"})}),Object(r.jsx)(J,{audioTrack:t,color:"black"})]})]})}function yt(){var e,t=Fe().filter((function(e){return"audiooutput"===e.kind})),n=ge(),i=n.activeSinkId,a=n.setActiveSinkId,o=null===(e=t.find((function(e){return e.deviceId===i})))||void 0===e?void 0:e.label;return Object(r.jsx)("div",{className:"inputSelect",children:t.length>1?Object(r.jsxs)(xt.a,{fullWidth:!0,children:[Object(r.jsx)(z.a,{variant:"subtitle2",gutterBottom:!0,children:"Audio Output"}),Object(r.jsx)(gt.a,{onChange:function(e){return a(e.target.value)},value:i,variant:"outlined",children:t.map((function(e){return Object(r.jsx)(ht.a,{value:e.deviceId,children:e.label},e.deviceId)}))})]}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(z.a,{variant:"subtitle2",children:"Audio Output"}),Object(r.jsx)(z.a,{children:o||"System Default Audio Output"})]})})}var kt=Object(F.a)({preview:{width:"300px",maxHeight:"200px",margin:"0.5em auto","& video":{maxHeight:"200px"}}});function Ct(){var e=kt(),t=Be(),n=Xe().localVideoTrack,a=W(n),o=null===a||void 0===a?void 0:a.getSettings().deviceId,c=Object(i.useState)(Ee.twilioVideoLastCamera),s=Object(d.a)(c,2),l=s[0],u=s[1],b=Object(i.useCallback)((function(e){Ee.twilioVideoLastCamera=e,u(e)}),[]);return Object(r.jsxs)("div",{children:[n&&Object(r.jsx)("div",{className:e.preview,children:Object(r.jsx)(ke,{isLocal:!0,track:n})}),t.length>1?Object(r.jsxs)(xt.a,{fullWidth:!0,children:[Object(r.jsx)(z.a,{variant:"subtitle2",gutterBottom:!0,children:"Video Input"}),Object(r.jsx)(gt.a,{onChange:function(e){return t=e.target.value,b(t),void(n&&n.restart(Object(ue.a)(Object(ue.a)({},He),{},{deviceId:{exact:t}})));var t},value:o||l,variant:"outlined",children:t.map((function(e){return Object(r.jsx)(ht.a,{value:e.deviceId,children:e.label},e.deviceId)}))})]}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(z.a,{variant:"subtitle2",gutterBottom:!0,children:"Video Input"}),Object(r.jsx)(z.a,{children:(null===n||void 0===n?void 0:n.mediaStreamTrack.label)||"No Local Video"})]})]})}var St=Object(F.a)((function(e){var t;return{container:(t={width:"600px",minHeight:"400px"},Object(D.a)(t,e.breakpoints.down("xs"),{width:"calc(100vw - 32px)"}),Object(D.a)(t,"& .inputSelect",{width:"calc(100% - 35px)"}),t),button:{float:"right"},paper:Object(D.a)({},e.breakpoints.down("xs"),{margin:"16px"}),headline:{marginBottom:"1.3em",fontSize:"1.1rem"},listSection:{margin:"2em 0 0.8em","&:first-child":{margin:"1em 0 2em 0"}}}}));function Tt(e){var t=e.open,n=e.onClose,i=St();return Object(r.jsxs)(ft.a,{open:t,onClose:n,classes:{paper:i.paper},children:[Object(r.jsx)(pt.a,{children:"Audio and Video Settings"}),Object(r.jsx)(vt.a,{}),Object(r.jsxs)(mt.a,{className:i.container,children:[Object(r.jsxs)("div",{className:i.listSection,children:[Object(r.jsx)(z.a,{variant:"h6",className:i.headline,children:"Video"}),Object(r.jsx)(Ct,{})]}),Object(r.jsx)(vt.a,{}),Object(r.jsxs)("div",{className:i.listSection,children:[Object(r.jsx)(z.a,{variant:"h6",className:i.headline,children:"Audio"}),Object(r.jsx)(wt,{})]}),Object(r.jsx)("div",{className:i.listSection,children:Object(r.jsx)(yt,{})})]}),Object(r.jsx)(vt.a,{}),Object(r.jsx)(Ot.a,{children:Object(r.jsx)(ot.a,{color:"primary",variant:"contained",className:i.button,onClick:n,children:"Done"})})]})}function Pt(e){Object(jt.a)((function(e){return e.breakpoints.down("sm")}));var t=Object(i.useState)(!1),n=Object(d.a)(t,2),a=(n[0],n[1]),o=Object(i.useState)(!1),c=Object(d.a)(o,2),s=c[0],l=c[1];Object(i.useRef)(null);return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(ht.a,{onClick:function(){return l(!0)},children:Object(r.jsx)(z.a,{variant:"body1",children:"A/V Settings"})}),Object(r.jsx)(Tt,{open:s,onClose:function(){l(!1),a(!1)}})]})}function Lt(){var e=Xe().room,t=Object(i.useState)("disconnected"),n=Object(d.a)(t,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){var t=function(){return a(e.state||"disconnected")};return t(),e.on("disconnected",t).on("reconnected",t).on("reconnecting",t),function(){e.off("disconnected",t).off("reconnected",t).off("reconnecting",t)}}),[e]),r}function Nt(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"17",viewBox:"0 0 12 17",children:Object(r.jsx)("path",{fill:"#707578",fillRule:"evenodd",d:"M11.389 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09C2.395 12.836 0 10.281 0 7.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM5.944 0C7.51 0 8.778 1.268 8.778 2.833v4.334C8.778 8.73 7.51 10 5.944 10 4.38 10 3.111 8.73 3.111 7.167V2.833C3.111 1.268 4.38 0 5.944 0zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334C4.111 8.179 4.933 9 5.944 9c1.013 0 1.834-.82 1.834-1.833V2.833C7.778 1.82 6.958 1 5.944 1z"})})}function Et(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"24",viewBox:"0 0 25 24",children:Object(r.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[Object(r.jsx)("path",{fill:"#707578",d:"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z",transform:"translate(6.5 4)"}),Object(r.jsx)("path",{fill:"red",d:"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z",transform:"translate(6.5 4)"})]})})}function It(){var e=Xe(),t=e.localAudioTrack,n=e.room.localParticipant,r=e.getLocalAudioTrack,a=e.removeLocalAudioTrack,o=H(t),c=Object(i.useState)(!1),s=Object(d.a)(c,2),b=s[0],h=s[1],j=Object(i.useCallback)((function(){if(t){var e;Ee.twilioVideoLastMic=null!==(e=t.mediaStreamTrack.getSettings().deviceId)&&void 0!==e?e:null;var r=null===n||void 0===n?void 0:n.unpublishTrack(t);null===n||void 0===n||n.emit("trackUnpublished",r),a()}}),[t,n,a]);return{isEnabled:o,toggleAudioEnabled:Object(i.useCallback)(Object(u.a)(l.a.mark((function e(){var i,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=22;break}if(!t){e.next=6;break}j(),Ee.twilioVideoMicEnabled=!1,e.next=22;break;case 6:return h(!0),e.prev=7,Ee.twilioVideoMicEnabled=!0,e.next=11,r(null!==(i=Ee.twilioVideoLastMic)&&void 0!==i?i:void 0);case 11:a=e.sent,null===n||void 0===n||n.publishTrack(a,{priority:"low"}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(7),"NotReadableError"!==(null===e.t0||void 0===e.t0?void 0:e.t0.name)&&"OverconstrainedError"!==(null===e.t0||void 0===e.t0?void 0:e.t0.name)||(Ee.twilioVideoLastMic=null),e.t0;case 19:return e.prev=19,h(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[7,15,19,22]])}))),[t,r,b,n,j]),stopAudio:j}}function Mt(e){var t=It(),n=t.isEnabled,a=t.toggleAudioEnabled,o=Object(i.useRef)(0),c=ze(),s=Object(i.useCallback)(Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(Date.now()-o.current>200)){t.next=10;break}return o.current=Date.now(),t.prev=2,t.next=5,a();case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),e.setMediaError&&e.setMediaError(t.t0);case 10:case"end":return t.stop()}}),t,null,[[2,7]])}))),[e,a]);return Object(r.jsx)(ot.a,{className:e.className,onClick:s,disabled:e.disabled||!c,startIcon:n?Object(r.jsx)(Nt,{}):Object(r.jsx)(Et,{}),"data-cy-audio-toggle":!0,children:c?n?"Mute":"Unmute":"No audio devices"})}function Dt(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:Object(r.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[Object(r.jsx)("path",{fill:"#707578",d:"M10.503.85c.32 0 .611.125.827.329l-.696.697c-.025-.018-.053-.032-.084-.038l-.047-.006H1.207c-.102 0-.19.071-.216.165l-.008.059v7.866c0 .101.07.189.165.215l.059.008h1.156l-.983.983h-.173c-.624 0-1.139-.476-1.2-1.083L0 9.922V2.056C0 1.433.476.917 1.084.856l.123-.007h9.296zm5.49 1.124l.007.082v7.866c0 .337-.328.566-.635.47l-.076-.03-3.58-1.79v1.35c0 .623-.476 1.138-1.083 1.2l-.123.006H4.16l.984-.983h5.359c.101 0 .189-.07.215-.164l.008-.06V4.564l.983-.982.353-.353 3.227-1.612c.301-.15.652.04.704.358zm-.977.876L11.71 4.504v2.967l3.307 1.654V2.85z",transform:"translate(4 6)"}),Object(r.jsx)("path",{fill:"red",fillRule:"nonzero",d:"M13.06.144c.192-.192.503-.192.695 0 .171.17.19.436.057.627l-.057.068-12.29 12.29c-.192.193-.503.193-.695 0-.171-.17-.19-.435-.057-.626l.057-.069L13.06.144z",transform:"translate(4 6)"})]})})}function Vt(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"24",viewBox:"0 0 25 24",children:Object(r.jsx)("path",{fill:"#707578",fillRule:"evenodd",d:"M15.003 7c.665 0 1.206.542 1.206 1.207v1.349l3.58-1.789c.301-.15.652.04.704.358l.007.082v7.866c0 .365-.385.603-.711.44l-3.58-1.79v1.35c0 .623-.476 1.138-1.083 1.2l-.123.006H5.707c-.665 0-1.207-.542-1.207-1.206V8.207C4.5 7.542 5.042 7 5.707 7zm0 .983H5.707c-.122 0-.224.102-.224.224v7.866c0 .121.102.223.224.223h9.296c.122 0 .223-.102.223-.223V8.207c0-.122-.101-.224-.223-.224zm4.513 1.019l-3.307 1.654v2.968l3.307 1.653V9.002z"})})}function At(e){var t=Ie(),n=t.isEnabled,a=t.toggleVideoEnabled,o=Object(i.useRef)(0),c=_e(),s=Object(i.useCallback)(Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(Date.now()-o.current>200)){t.next=10;break}return o.current=Date.now(),t.prev=2,t.next=5,a();case 5:t.next=10;break;case 7:t.prev=7,t.t0=t.catch(2),e.setMediaError&&e.setMediaError(t.t0);case 10:case"end":return t.stop()}}),t,null,[[2,7]])}))),[e,a]);return Object(r.jsx)(ot.a,{className:e.className,onClick:s,disabled:!c||e.disabled,startIcon:n?Object(r.jsx)(Vt,{}):Object(r.jsx)(Dt,{}),children:c?n?"Stop Video":"Start Video":"No video devices"})}var Ft=Object(F.a)((function(e){return Object(B.a)({button:{margin:e.spacing(1),"&[disabled]":{color:"#bbb","& svg *":{fill:"#bbb"}}}})}));function Rt(e){var t=Ft(),n=Ue(),i=Xe().toggleScreenShare,a=Boolean(n),o=navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia,c=e.disabled||a||!o,s="";return a&&(s="Cannot share screen when another user is sharing"),o||(s="Screen sharing is not supported with this browser"),Object(r.jsx)(ee.a,{title:s,placement:"top",PopperProps:{disablePortal:!0},style:{cursor:c?"not-allowed":"pointer"},children:Object(r.jsx)("span",{children:Object(r.jsx)(ot.a,{className:t.button,onClick:i,disabled:c,startIcon:Object(r.jsx)(re,{}),"data-cy-share-screen":!0,children:"Share Screen"})})})}var Bt=n(529),zt=n(545),_t=n(544),Ht=n(107),Wt=n(532),Kt=n(556),Ut=n(546),Gt=n(551),Yt=a.a.createContext(null);function qt(){return Object(i.useContext)(Yt)}var Jt=function(){var e=Object(Bt.a)(),t=e.isOpen,n=e.onOpen,a=e.onClose,o=qt(),c=E(),s=c.apiClient,b=c.currentTownID,h=c.currentTownFriendlyName,j=c.currentTownIsPubliclyListed,f=Object(i.useState)(h),p=Object(d.a)(f,2),v=p[0],m=p[1],O=Object(i.useState)(j),x=Object(d.a)(O,2),g=x[0],w=x[1],y=Object(i.useState)(""),k=Object(d.a)(y,2),C=k[0],S=k[1],T=Object(i.useCallback)((function(){n(),null===o||void 0===o||o.pauseGame()}),[n,o]),P=Object(i.useCallback)((function(){a(),null===o||void 0===o||o.unPauseGame()}),[a,o]),L=Object(zt.a)(),N=function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("delete"!==t){e.next=13;break}return e.prev=1,e.next=4,s.deleteTown({coveyTownID:b,coveyTownPassword:C});case 4:L({title:"Town deleted",status:"success"}),P(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),L({title:"Unable to delete town",description:e.t0.toString(),status:"error"});case 11:e.next=23;break;case 13:return e.prev=13,e.next=16,s.updateTown({coveyTownID:b,coveyTownPassword:C,friendlyName:v,isPubliclyListed:g});case 16:L({title:"Town updated",description:"To see the updated town, please exit and re-join this town",status:"success"}),P(),e.next=23;break;case 20:e.prev=20,e.t1=e.catch(13),L({title:"Unable to update town",description:e.t1.toString(),status:"error"});case 23:case"end":return e.stop()}}),e,null,[[1,8],[13,20]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(ht.a,{"data-testid":"openMenuButton",onClick:T,children:Object(r.jsx)(z.a,{variant:"body1",children:"Town Settings"})}),Object(r.jsxs)(_t.a,{isOpen:t,onClose:P,children:[Object(r.jsx)(_t.g,{}),Object(r.jsxs)(_t.d,{children:[Object(r.jsxs)(_t.f,{children:["Edit town ",h," (",b,")"]}),Object(r.jsx)(_t.c,{}),Object(r.jsxs)("form",{onSubmit:function(e){e.preventDefault(),N("edit")},children:[Object(r.jsxs)(_t.b,{pb:6,children:[Object(r.jsxs)(Ht.a,{children:[Object(r.jsx)(Wt.a,{htmlFor:"friendlyName",children:"Friendly Name"}),Object(r.jsx)(Kt.a,{id:"friendlyName",placeholder:"Friendly Name",name:"friendlyName",value:v,onChange:function(e){return m(e.target.value)}})]}),Object(r.jsxs)(Ht.a,{mt:4,children:[Object(r.jsx)(Wt.a,{htmlFor:"isPubliclyListed",children:"Publicly Listed"}),Object(r.jsx)(Ut.a,{id:"isPubliclyListed",name:"isPubliclyListed",isChecked:g,onChange:function(e){return w(e.target.checked)}})]}),Object(r.jsxs)(Ht.a,{isRequired:!0,children:[Object(r.jsx)(Wt.a,{htmlFor:"updatePassword",children:"Town Update Password"}),Object(r.jsx)(Kt.a,{"data-testid":"updatePassword",id:"updatePassword",placeholder:"Password",name:"password",type:"password",value:C,onChange:function(e){return S(e.target.value)}})]})]}),Object(r.jsxs)(_t.e,{children:[Object(r.jsx)(Gt.a,{"data-testid":"deletebutton",colorScheme:"red",mr:3,value:"delete",name:"action1",onClick:function(){return N("delete")},children:"Delete"}),Object(r.jsx)(Gt.a,{"data-testid":"updatebutton",colorScheme:"blue",mr:3,value:"update",name:"action2",onClick:function(){return N("edit")},children:"Update"}),Object(r.jsx)(Gt.a,{onClick:P,children:"Cancel"})]})]})]})]})]})},Qt=Object(F.a)((function(e){return Object(B.a)({container:Object(D.a)({backgroundColor:e.palette.background.default,bottom:20,left:0,right:0,position:"absolute",display:"flex",padding:"0 1.43em",zIndex:10},e.breakpoints.down("sm"),{height:"".concat(e.mobileFooterHeight,"px"),padding:0}),screenShareBanner:{position:"absolute",zIndex:10,bottom:"".concat(e.footerHeight,"px"),left:0,right:0,height:"104px",background:"rgba(0, 0, 0, 0.5)","& h6":{color:"white"},"& button":{background:"white",color:e.brand,border:"2px solid ".concat(e.brand),margin:"0 2em","&:hover":{color:"#600101",border:"2px solid #600101",background:"#FFE9E7"}}},hideMobile:Object(D.a)({display:"initial"},e.breakpoints.down("sm"),{display:"none"})})}));function Xt(e){var t=Qt(),n=Xe(),i=n.isSharingScreen,a=n.toggleScreenShare,o="reconnecting"===Lt();return Object(r.jsxs)(r.Fragment,{children:[i&&Object(r.jsxs)(ct.a,{container:!0,justify:"center",alignItems:"center",className:t.screenShareBanner,children:[Object(r.jsx)(z.a,{variant:"h6",children:"You are sharing your screen"}),Object(r.jsx)(ot.a,{onClick:function(){return a()},children:"Stop Sharing"})]}),Object(r.jsx)("footer",{className:t.container,children:Object(r.jsxs)(ct.a,{container:!0,justify:"space-around",alignItems:"center",children:[Object(r.jsx)(ct.a,{item:!0,children:Object(r.jsxs)(ct.a,{container:!0,justify:"center",children:[Object(r.jsx)(Mt,{disabled:o,setMediaError:e.setMediaError}),Object(r.jsx)(At,{disabled:o,setMediaError:e.setMediaError}),Object(r.jsx)(st.a,{smDown:!0,children:!i&&Object(r.jsx)(Rt,{disabled:o})}),Object(r.jsx)(bt,{})]})}),Object(r.jsx)(st.a,{smDown:!0,children:Object(r.jsx)(ct.a,{style:{flex:1},children:Object(r.jsxs)(ct.a,{container:!0,justify:"flex-end",children:[Object(r.jsx)(Jt,{}),Object(r.jsx)(Pt,{}),Object(r.jsx)(dt,{})]})})})]})})]})}var Zt=Object(F.a)((function(e){return{container:Object(D.a)({background:"white",paddingLeft:"1em",display:"none",height:"".concat(e.mobileTopBarHeight,"px")},e.breakpoints.down("sm"),{display:"flex"}),endCallButton:{height:"28px",fontSize:"0.85rem",padding:"0 0.6em"},settingsButton:Object(D.a)({},e.breakpoints.down("sm"),{height:"28px",minWidth:"28px",border:"1px solid rgb(136, 140, 142)",padding:0,margin:"0 1em"})}}));function $t(){var e=Zt(),t=Xe().room;return Object(r.jsxs)(ct.a,{container:!0,alignItems:"center",justify:"space-between",className:e.container,children:[Object(r.jsx)(z.a,{variant:"subtitle1",children:t.name}),Object(r.jsxs)("div",{children:[Object(r.jsx)(dt,{className:e.endCallButton}),Object(r.jsx)(Pt,{buttonClassName:e.settingsButton})]})]})}var en=n(269),tn=n.n(en),nn=n(534),rn=n(552);function an(){return Object(r.jsx)("svg",{width:"14px",height:"14px",viewBox:"0 0 14 14",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(r.jsx)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:Object(r.jsx)("g",{transform:"translate(-299.000000, -723.000000)",fill:"#D61F1F",children:Object(r.jsx)("g",{transform:"translate(276.000000, 704.000000)",children:Object(r.jsx)("g",{transform:"translate(23.000000, 19.000000)",children:Object(r.jsx)("path",{d:"M8.03935839,0.763849674 L13.2361503,5.96064161 C13.8101721,6.5346634 13.8101721,7.4653366 13.2361503,8.03935839 L8.03935839,13.2361503 C7.4653366,13.8101721 6.5346634,13.8101721 5.96064161,13.2361503 L0.763849674,8.03935839 C0.189827887,7.4653366 0.189827887,6.5346634 0.763849674,5.96064161 L5.96064161,0.763849674 C6.5346634,0.189827887 7.4653366,0.189827887 8.03935839,0.763849674 Z M7,8.66666667 C6.53976271,8.66666667 6.16666667,9.03976271 6.16666667,9.5 C6.16666667,9.96023729 6.53976271,10.3333333 7,10.3333333 C7.46023729,10.3333333 7.83333333,9.96023729 7.83333333,9.5 C7.83333333,9.03976271 7.46023729,8.66666667 7,8.66666667 Z M7.00842529,4.5 L6.99145559,4.5 C6.48802096,4.5 6.09771771,4.99363437 6.17690967,5.53663218 L6.53327351,7.40140326 C6.56721292,7.64822044 6.76519283,7.83333333 6.99711216,7.83333333 L7.00276873,7.83333333 C7.23468805,7.83333333 7.43266796,7.64822044 7.46660737,7.40140326 L7.82297121,5.53663218 C7.90216317,4.99363437 7.51751649,4.50617043 7.00842529,4.5 Z",id:"Error"})})})})})})}function on(){return Object(r.jsx)("svg",{width:"16px",height:"14px",viewBox:"0 0 16 14",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:Object(r.jsx)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:Object(r.jsx)("g",{transform:"translate(-273.000000, -162.000000)",fill:"#E46216",children:Object(r.jsx)("g",{transform:"translate(251.000000, 143.000000)",children:Object(r.jsx)("g",{transform:"translate(22.000000, 19.000000)",children:Object(r.jsx)("path",{d:"M6.68405227,0.743750848 C7.26590697,-0.247916949 8.73410873,-0.247916949 9.31596344,0.743750848 L9.31596344,0.743750848 L15.7980583,11.7915293 C16.3754418,12.775573 15.6458879,14 14.4821027,14 L14.4821027,14 L1.5178827,14 C0.354135396,14 -0.375441293,12.775573 0.201934693,11.7915293 L0.201934693,11.7915293 Z M8,10 C7.44771525,10 7,10.4477153 7,11 C7,11.5522847 7.44771525,12 8,12 C8.55228475,12 9,11.5522847 9,11 C9,10.4477153 8.55228475,10 8,10 Z M8.01011035,5 L7.98974671,5 L7.87816923,5.00681158 C7.32928042,5.07427655 6.92320065,5.63308608 7.01229161,6.24395862 L7.01229161,6.24395862 L7.43992821,8.48168391 L7.46058982,8.57746523 C7.53403676,8.82448556 7.74990819,9 8.00332247,9 L8.00332247,9 L8.09436762,8.9919759 C8.33199007,8.94972242 8.5237268,8.74495557 8.55992884,8.48168391 L8.55992884,8.48168391 L8.98756545,6.24395862 L8.99896034,6.12268979 C9.02431547,5.52149772 8.58283795,5.00694173 8.01011035,5 L8.01011035,5 Z"})})})})})})}var cn=Object(F.a)((function(e){return{container:Object(D.a)({display:"flex",alignItems:"baseline",justifyContent:"space-between",width:"400px",minHeight:"50px",background:"white",padding:"1em",borderRadius:"3px",boxShadow:"0 12px 24px 4px rgba(40,42,43,0.2)"},e.breakpoints.down("sm"),{width:"100%"}),contentContainer:{display:"flex"},iconContainer:{display:"flex",padding:"0 1.3em 0 0.3em",transform:"translateY(4px)"},headline:{fontWeight:"bold"},error:{borderLeft:"4px solid #D61F1F"},warning:{borderLeft:"4px solid #E46216"}}}));function sn(e){var t,n=e.headline,i=e.message,a=e.variant,o=e.open,c=e.handleClose,s=cn();return Object(r.jsx)(rn.a,{anchorOrigin:{vertical:"top",horizontal:"right"},open:o,onClose:function(e,t){"clickaway"!==t&&(null===c||void 0===c||c())},children:Object(r.jsxs)("div",{className:Object(R.a)(s.container,(t={},Object(D.a)(t,s.error,"error"===a),Object(D.a)(t,s.warning,"warning"===a),t)),children:[Object(r.jsxs)("div",{className:s.contentContainer,children:[Object(r.jsxs)("div",{className:s.iconContainer,children:["warning"===a&&Object(r.jsx)(on,{}),"error"===a&&Object(r.jsx)(an,{})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)(z.a,{variant:"body1",className:s.headline,component:"span",children:n}),Object(r.jsxs)(z.a,{variant:"body1",component:"span",children:[" ",i]})]})]}),Object(r.jsx)("div",{children:c&&Object(r.jsx)(nn.a,{size:"small","aria-label":"close",color:"inherit",onClick:c,children:Object(r.jsx)(tn.a,{fontSize:"small"})})})]})})}function ln(){var e=Lt();return Object(r.jsx)(sn,{variant:"error",headline:"Connection Lost:",message:"Reconnecting to room...",open:"reconnecting"===e})}n(462);function dn(e){var t=e.error,n=e.dismissError,i=ze(),a=_e(),o=!Xe().isAcquiringLocalTracks&&(Boolean(t)||!i||!a),c=function(e,t,n){var i="",a="";switch(!0){case"NotAllowedError"===(null===n||void 0===n?void 0:n.name):i="Unable to Access Media:",a="Permission denied by system"===n.message?"The operating system has blocked the browser from accessing the microphone or camera. Please check your operating system settings.":Object(r.jsxs)(r.Fragment,{children:["Clowdr has been denied permission to use audio and video.",Object(r.jsx)("br",{}),"Learn how to enable audio and video in your browser:",Object(r.jsxs)("ul",{style:{marginTop:"0.4em"},children:[Object(r.jsx)("li",{children:Object(r.jsx)("a",{href:"https://support.google.com/chrome/answer/2693767",target:"_blank",rel:"noopener noreferrer",children:"Google Chrome"})}),Object(r.jsx)("li",{children:Object(r.jsx)("a",{href:"https://support.mozilla.org/en-US/kb/how-manage-your-camera-and-microphone-permissions",target:"_blank",rel:"noopener noreferrer",children:"Mozilla Firefox"})})]})]});break;case"NotFoundError"===(null===n||void 0===n?void 0:n.name):i="Cannot Find Microphone or Camera:",a="The browser cannot access the microphone or camera. Please make sure all input devices are connected and enabled.";break;case Boolean(n):i="Error Acquiring Media:",a="".concat(n.name," ").concat(n.message);break;case!e&&!t:i="No Camera or Microphone Detected:",a="Other participants in the room will be unable to see and hear you.";break;case!t:i="No Camera Detected:",a="Other participants in the room will be unable to see you.";break;case!e:i="No Microphone Detected:",a="Other participants in the room will be unable to hear you."}return{headline:i,message:a}}(i,a,t),s=c.headline,l=c.message;return Object(r.jsx)(sn,{open:o,handleClose:function(){n&&n()},headline:s,message:l,variant:"warning"})}var un=Object(V.a)("div")({display:"grid",gridTemplateRows:"1fr auto"}),bn=Object(V.a)("main")((function(e){var t=e.theme;return Object(D.a)({overflow:"hidden",position:"relative",paddingBottom:"".concat(t.footerHeight,"px")},t.breakpoints.down("sm"),{paddingBottom:"".concat(t.mobileFooterHeight+t.mobileTopBarHeight,"px")})}));function hn(e){var t=Xe().room,n=Lt(),a=qt(),o=It().stopAudio,c=Ie().stopVideo,s=Object(i.useRef)(),l=Object(i.useRef)(),u=Object(i.useRef)(),b=Object(i.useState)(),h=Object(d.a)(b,2),j=h[0],f=h[1],p=Ye(),v=null===a||void 0===a?void 0:a.coveyTownID;return v||(v="Disconnected"),Object(i.useEffect)((function(){function e(){try{o()}catch(e){}try{c()}catch(r){}try{"connected"!==n&&"reconnecting"!==n||t.disconnect()}catch(i){}}s.current=function(){e()},l.current=function(t){t.preventDefault(),e()}}),[t,n,o,c]),Object(i.useEffect)((function(){return function(){s&&s.current&&s.current()}}),[]),Object(i.useEffect)((function(){return l&&l.current&&window.addEventListener("beforeunload",l.current),function(){l&&l.current&&window.removeEventListener("beforeunload",l.current)}}),[]),Object(i.useEffect)((function(){!u.current||t.sid===u.current.sid&&v===u.current.sid||"connected"===u.current.state&&u.current.disconnect(),u.current=t}),[t.sid,t,v]),Object(i.useEffect)((function(){var t="presenting"===p;e.onPresentingChanged&&e.onPresentingChanged(t)}),[p,e]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(A.a,{when:"disconnected"!==n,message:"Are you sure you want to leave the video room?"}),Object(r.jsxs)(un,{style:{height:"100%"},className:"video-grid",children:["disconnected"===n?Object(r.jsx)("div",{children:"Error"}):Object(r.jsxs)(bn,{style:{paddingBottom:"90px"},children:[Object(r.jsx)(ln,{}),Object(r.jsx)($t,{}),Object(r.jsx)(at,{}),Object(r.jsx)(Xt,{setMediaError:f})]}),Object(r.jsx)(dn,{error:j,dismissError:function(){return f(void 0)}})]})]})}var jn=n(536),fn=n(539),pn=n(270);function vn(){var e=Xe().localAudioTrack;return Object(r.jsx)(J,{audioTrack:e})}var mn=Object(F.a)((function(e){return{container:{position:"relative",height:0,overflow:"hidden",paddingTop:"".concat(56.25,"%"),background:"black"},innerContainer:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},identityContainer:{position:"absolute",bottom:0,zIndex:1},identity:{background:"rgba(0, 0, 0, 0.5)",color:"white",padding:"0.18em 0.3em",margin:0,display:"flex",alignItems:"center"},avatarContainer:Object(D.a)({display:"flex",alignItems:"center",justifyContent:"center",background:"black",position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:1},e.breakpoints.down("sm"),{"& svg":{transform:"scale(0.7)"}})}}));function On(e){var t=e.identity,n=mn(),i=Xe().localVideoTrack;return Object(r.jsxs)("div",{className:n.container,children:[Object(r.jsx)("div",{className:n.innerContainer,children:i?Object(r.jsx)(ke,{track:i,isLocal:!0}):Object(r.jsx)("div",{className:n.avatarContainer,children:Object(r.jsx)(Q,{})})}),Object(r.jsx)("div",{className:n.identityContainer,children:Object(r.jsxs)("span",{className:n.identity,children:[Object(r.jsx)(vn,{}),Object(r.jsx)(z.a,{variant:"body1",color:"inherit",component:"span",children:t})]})})]})}var xn=n(273),gn=n(271),wn=n.n(gn),yn=n(561),kn=n(562),Cn=[{label:"Low (160 x 90)",value:"low",resolution:{width:160,height:90}},{label:"CIF (352 x 288)",value:"cif",resolution:{width:352,height:288}},{label:"VGA (640 x 480)",value:"vga",resolution:{width:640,height:480}},{label:"WVGA (800 x 480)",value:"wvga",resolution:{width:800,height:480}},{label:"HD 540P (960 x 540)",value:"540p",resolution:{width:960,height:540}},{label:"HD 720P (1280 x 720)",value:"720p",resolution:{width:1280,height:720}},{label:"HD 960P (1280 x 960)",value:"960p",resolution:{width:1280,height:960}},{label:"HD Standard 1080P (1440 x 1080)",value:"standard1080p",resolution:{width:1440,height:1080}},{label:"HD Widescreen 1080P (1920 x 1080)",value:"wide1080p",resolution:{width:1920,height:1080}},{label:"Server Default",value:"default",resolution:void 0}];var Sn=Object(F.a)((function(e){var t;return{container:(t={width:"600px",minHeight:"400px"},Object(D.a)(t,e.breakpoints.down("xs"),{width:"calc(100vw - 32px)"}),Object(D.a)(t,"& .inputSelect",{width:"calc(100% - 35px)"}),t),button:{float:"right"},paper:Object(D.a)({},e.breakpoints.down("xs"),{margin:"16px"}),formControl:{display:"block",margin:"1.5em 0","&:first-child":{margin:"0 0 1.5em 0"}},label:{width:"133%"}}})),Tn=function(e){return"undefined"===typeof e?"default":e},Pn=Cn.map((function(e){var t=e.label,n=e.value;return Object(r.jsx)(ht.a,{value:n,children:t},n)}));function Ln(e){var t=e.open,n=e.onClose,a=Sn(),o=ge(),c=o.settings,s=o.dispatchSetting,l="disconnected"!==Lt(),d=Object(i.useCallback)((function(e){s({name:e.target.name,value:e.target.value})}),[s]),u=Object(i.useCallback)((function(e){/[^\d]/.test(e.target.value)||d(e)}),[d]);return Object(r.jsxs)(ft.a,{open:t,onClose:n,classes:{paper:a.paper},children:[Object(r.jsx)(pt.a,{children:"Connection Settings"}),Object(r.jsx)(vt.a,{}),Object(r.jsx)(mt.a,{className:a.container,children:Object(r.jsxs)(ct.a,{container:!0,spacing:2,children:[Object(r.jsx)(ct.a,{item:!0,xs:12,children:Object(r.jsx)(z.a,{hidden:!l,variant:"body2",children:"These settings cannot be changed when connected to a room."})}),Object(r.jsxs)(ct.a,{item:!0,sm:6,xs:12,children:[Object(r.jsxs)(xt.a,{className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.dominantSpeakerPriority,children:"Dominant Speaker Priority:"}),Object(r.jsxs)(gt.a,{fullWidth:!0,disabled:l,name:ve.dominantSpeakerPriority,label:ve.dominantSpeakerPriority,value:Tn(c.dominantSpeakerPriority),onChange:d,children:[Object(r.jsx)(ht.a,{value:"low",children:"Low"}),Object(r.jsx)(ht.a,{value:"standard",children:"Standard"}),Object(r.jsx)(ht.a,{value:"high",children:"High"}),Object(r.jsx)(ht.a,{value:"default",children:"Server Default"})]})]}),Object(r.jsxs)(xt.a,{className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.trackSwitchOffMode,children:"Track Switch Off Mode:"}),Object(r.jsxs)(gt.a,{fullWidth:!0,disabled:l,name:ve.trackSwitchOffMode,label:ve.trackSwitchOffMode,value:Tn(c.trackSwitchOffMode),onChange:d,children:[Object(r.jsx)(ht.a,{value:"predicted",children:"Predicted"}),Object(r.jsx)(ht.a,{value:"detected",children:"Detected"}),Object(r.jsx)(ht.a,{value:"disabled",children:"Disabled"}),Object(r.jsx)(ht.a,{value:"default",children:"Server Default"})]})]}),Object(r.jsxs)(xt.a,{className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.bandwidthProfileMode,children:"Mode:"}),Object(r.jsxs)(gt.a,{fullWidth:!0,disabled:l,name:ve.bandwidthProfileMode,label:ve.bandwidthProfileMode,value:Tn(c.bandwidthProfileMode),onChange:d,children:[Object(r.jsx)(ht.a,{value:"grid",children:"Grid"}),Object(r.jsx)(ht.a,{value:"collaboration",children:"Collaboration"}),Object(r.jsx)(ht.a,{value:"presentation",children:"Presentation"}),Object(r.jsx)(ht.a,{value:"default",children:"Server Default"})]})]}),Object(r.jsx)(xt.a,{className:a.formControl,children:Object(r.jsx)(kn.a,{disabled:l,fullWidth:!0,id:ve.maxTracks,label:"Max Tracks",placeholder:"Leave blank for no limit",name:ve.maxTracks,value:Tn(c.maxTracks),onChange:u})}),Object(r.jsx)(xt.a,{className:a.formControl,children:Object(r.jsx)(kn.a,{disabled:l,fullWidth:!0,id:ve.maxAudioBitrate,label:"Max Audio Bitrate",placeholder:"Leave blank for no limit",name:ve.maxAudioBitrate,value:Tn(c.maxAudioBitrate),onChange:u})})]}),Object(r.jsxs)(ct.a,{item:!0,sm:6,xs:12,children:[Object(r.jsxs)(xt.a,{fullWidth:!0,className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.renderDimensionLow,className:a.label,children:"Render Dimension (Low Priority):"}),Object(r.jsx)(gt.a,{fullWidth:!0,disabled:l,name:ve.renderDimensionLow,label:ve.renderDimensionLow,value:Tn(c.renderDimensionLow),onChange:d,children:Pn})]}),Object(r.jsxs)(xt.a,{fullWidth:!0,className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.renderDimensionStandard,className:a.label,children:"Render Dimension (Standard Priority):"}),Object(r.jsx)(gt.a,{fullWidth:!0,disabled:l,name:ve.renderDimensionStandard,label:ve.renderDimensionStandard,value:Tn(c.renderDimensionStandard),onChange:d,children:Pn})]}),Object(r.jsxs)(xt.a,{fullWidth:!0,className:a.formControl,children:[Object(r.jsx)(yn.a,{id:ve.renderDimensionHigh,className:a.label,children:"Render Dimension (High Priority):"}),Object(r.jsx)(gt.a,{fullWidth:!0,disabled:l,name:ve.renderDimensionHigh,label:ve.renderDimensionHigh,value:Tn(c.renderDimensionHigh),onChange:d,children:Pn})]})]})]})}),Object(r.jsx)(vt.a,{}),Object(r.jsx)(Ot.a,{children:Object(r.jsx)(ot.a,{className:a.button,color:"primary",variant:"contained",onClick:n,children:"Done"})})]})}function Nn(){return Object(r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:Object(r.jsx)("g",{fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round",children:Object(r.jsx)("g",{fill:"#707578",children:Object(r.jsx)("path",{d:"M10 .833c.276 0 .5.224.5.5l-.001 1.775.16.042c.423.113.775.226 1.072.35l.121.054 1.273-1.272c.173-.173.442-.192.637-.057l.07.057 1.886 1.886c.195.196.195.512 0 .708l-1.273 1.27.055.123c.125.297.238.65.351 1.073l.041.158h1.775c.245 0 .45.177.492.41l.008.09v2c0 .276-.224.5-.5.5H14.89l-.03.118c-.115.431-.231.798-.358 1.103l-.058.131 1.273 1.273c.173.174.192.443.057.638l-.057.07-1.886 1.885c-.195.195-.511.195-.707 0l-1.273-1.272-.12.053c-.296.125-.648.238-1.071.352l-.162.041.001 1.775c0 .245-.177.45-.41.492l-.09.008H8c-.276 0-.5-.224-.5-.5l-.001-1.775-.161-.042c-.425-.114-.776-.227-1.072-.351l-.12-.054-1.271 1.272c-.174.174-.443.193-.638.058l-.07-.057-1.885-1.886c-.195-.195-.196-.512 0-.707l1.272-1.273-.053-.12c-.125-.296-.238-.648-.352-1.071l-.042-.161H1.333c-.245 0-.45-.177-.492-.41L.833 10V8c0-.276.224-.5.5-.5h1.774l.042-.16c.114-.424.227-.776.352-1.072l.052-.121-1.271-1.271c-.174-.174-.193-.443-.058-.638l.058-.07 1.886-1.886c.195-.195.512-.195.707 0l1.272 1.272.121-.053c.297-.125.65-.238 1.073-.351l.158-.042.001-1.775c0-.245.177-.45.41-.492L8 .833zm-.501 1h-1L8.5 3.499c0 .202-.121.38-.302.459l-.08.027c-.857.206-1.458.397-1.805.608-.197.12-.45.09-.614-.073L4.521 3.342 3.342 4.521 4.52 5.699c.14.14.182.347.116.527l-.043.087c-.211.347-.402.947-.61 1.805-.054.224-.255.382-.486.382H1.833v1h1.664c.202 0 .381.121.46.301l.026.081c.208.858.399 1.458.61 1.805.12.197.09.45-.073.614l-1.178 1.177 1.178 1.179 1.178-1.178c.14-.14.347-.182.528-.115l.087.042c.277.17.714.325 1.32.487l.485.124c.224.054.382.255.382.486l-.001 1.663h1l.001-1.663c0-.202.121-.381.301-.46l.081-.026c.858-.208 1.458-.399 1.804-.61.197-.12.45-.09.614.073l1.178 1.177 1.179-1.179-1.177-1.177c-.14-.14-.182-.347-.116-.527l.043-.087c.189-.31.37-.852.554-1.577l.056-.23c.055-.223.256-.38.486-.38h1.663v-1h-1.664c-.202 0-.381-.121-.46-.302l-.026-.08c-.206-.854-.398-1.458-.61-1.806-.12-.197-.09-.45.074-.614l1.176-1.177-1.178-1.178L12.3 4.52c-.14.14-.346.182-.526.116l-.088-.043c-.277-.169-.717-.325-1.32-.486l-.483-.122C9.658 3.93 9.5 3.73 9.5 3.499l-.001-1.666zm1.976 4.692c1.367 1.367 1.367 3.583 0 4.95s-3.583 1.367-4.95 0-1.367-3.583 0-4.95 3.583-1.367 4.95 0zm-4.243.707c-.976.977-.976 2.56 0 3.536.977.976 2.56.976 3.536 0 .934-.934.974-2.423.122-3.405l-.122-.13-.13-.123c-.983-.852-2.472-.812-3.406.122z",transform:"translate(-636 -585) translate(276 301) translate(360 284) translate(3 3)"})})})})}var En=Object(F.a)((function(e){return{settingsButton:{margin:"1.8em 0 0","&:hover":{color:"black"}}}}));function In(e){var t=e.mobileButtonClass,n=En(),a=ge().roomType,o=Object(jt.a)((function(e){return e.breakpoints.down("sm")})),c=Object(i.useState)(!1),s=Object(d.a)(c,2),l=s[0],u=s[1],b=Object(i.useState)(!1),h=Object(d.a)(b,2),j=h[0],f=h[1],p=Object(i.useState)(!1),v=Object(d.a)(p,2),m=v[0],O=v[1],x=Object(i.useRef)(null);return Object(r.jsxs)(r.Fragment,{children:[o?Object(r.jsx)(ot.a,{ref:x,onClick:function(){return u(!0)},startIcon:Object(r.jsx)(wn.a,{}),className:t,children:"More"}):Object(r.jsx)(ot.a,{ref:x,onClick:function(){return u(!0)},startIcon:Object(r.jsx)(Nn,{}),className:n.settingsButton,children:"Settings"}),Object(r.jsxs)(xn.a,{open:l,onClose:function(){return u((function(e){return!e}))},anchorEl:x.current,anchorOrigin:{vertical:"bottom",horizontal:o?"left":"right"},transformOrigin:{vertical:o?-55:-45,horizontal:"center"},children:[Object(r.jsx)(ht.a,{onClick:function(){return f(!0)},children:Object(r.jsx)(z.a,{variant:"body1",children:"Audio and Video Settings"})}),"peer-to-peer"!==a&&"go"!==a&&Object(r.jsx)(ht.a,{onClick:function(){return O(!0)},children:Object(r.jsx)(z.a,{variant:"body1",children:"Connection Settings"})})]}),Object(r.jsx)(Tt,{open:j,onClose:function(){f(!1),u(!1)}}),Object(r.jsx)(Ln,{open:m,onClose:function(){O(!1),u(!1)}})]})}var Mn=Object(F.a)((function(e){return{gutterBottom:{marginBottom:"1em"},marginTop:{marginTop:"1em"},deviceButton:{color:"black",width:"100%",border:"2px solid #aaa",margin:"1em 0","&:hover":{color:"black"}},localPreviewContainer:Object(D.a)({paddingRight:"2em"},e.breakpoints.down("sm"),{padding:"0 2.5em"}),joinButtons:Object(D.a)({display:"flex",justifyContent:"space-between"},e.breakpoints.down("sm"),{flexDirection:"column-reverse",width:"100%","& button":{margin:"0.5em 0"}}),mobileButtonBar:Object(D.a)({},e.breakpoints.down("sm"),{display:"flex",justifyContent:"space-between",margin:"1.5em 0 1em"}),mobileButton:{padding:"0.8em 0",margin:0}}}));function Dn(e){var t=e.setMediaError,n=Mn(),i=ge(),a=(i.getToken,i.isFetching),o=Xe(),c=(o.connect,o.isAcquiringLocalTracks),s=o.isConnecting,l=(o.localAudioTrack,o.localVideoTrack,a||c||s),d=Object(pn.a)();d.handleSubmit,d.errors,d.register,d.formState;return Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)(ct.a,{container:!0,justify:"center","aria-label":"join video room form",children:[Object(r.jsxs)(ct.a,{item:!0,md:7,sm:12,xs:12,children:[Object(r.jsx)("div",{className:n.localPreviewContainer,children:Object(r.jsx)(On,{identity:""})}),Object(r.jsxs)("div",{className:n.mobileButtonBar,children:[Object(r.jsxs)(st.a,{mdUp:!0,children:[Object(r.jsx)(Mt,{className:n.mobileButton,disabled:l,setMediaError:t}),Object(r.jsx)(At,{className:n.mobileButton,disabled:l,setMediaError:t})]}),Object(r.jsx)(In,{mobileButtonClass:n.mobileButton})]})]}),Object(r.jsx)(ct.a,{item:!0,md:5,sm:12,xs:12,children:Object(r.jsx)(ct.a,{container:!0,direction:"column",justify:"space-between",style:{height:"100%"},children:Object(r.jsx)("div",{children:Object(r.jsxs)(st.a,{smDown:!0,children:[Object(r.jsx)(Mt,{className:n.deviceButton,disabled:l,setMediaError:t}),Object(r.jsx)(At,{className:n.deviceButton,disabled:l,setMediaError:t})]})})})})]})})}var Vn=Object(F.a)((function(e){return{background:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},container:{position:"relative",flex:"1"},innerContainer:{display:"block",height:"auto",width:"calc(100% - 40px)",margin:"10px auto",maxWidth:"700px",borderRadius:"8px",border:"1px solid #ccc",overflow:"hidden",position:"relative"},content:{background:"white",width:"100%",padding:"2em",flex:1},subContentContainer:{marginTop:"1em",width:"100%"}}})),An=function(e){var t=Vn();return Object(r.jsx)("div",{className:t.background,children:Object(r.jsxs)("div",{className:t.container,children:[Object(r.jsx)("div",{className:t.innerContainer,children:Object(r.jsx)("div",{className:t.content,children:e.children})}),e.subContent&&Object(r.jsx)("div",{className:t.subContentContainer,children:e.subContent})]})})},Fn=n(557),Rn=n(535),Bn=n(537),zn=n(538);function _n(e){var t,n=e.doLogin,a=Object(i.useState)((null===(t=L.instance())||void 0===t?void 0:t.userName)||""),o=Object(d.a)(a,2),c=o[0],s=o[1],b=Object(i.useState)(""),h=Object(d.a)(b,2),j=h[0],f=h[1],p=Object(i.useState)(!0),m=Object(d.a)(p,2),O=m[0],x=m[1],g=Object(i.useState)(""),w=Object(d.a)(g,2),y=w[0],k=w[1],C=Object(i.useState)(),S=Object(d.a)(C,2),T=S[0],P=S[1],N=Xe().connect,I=E().apiClient,M=Object(zt.a)(),D=Object(i.useCallback)((function(){I.listTowns().then((function(e){P(e.towns.sort((function(e,t){return t.currentOccupancy-e.currentOccupancy})))}))}),[P,I]);Object(i.useEffect)((function(){D();var e=setInterval(D,2e3);return function(){clearInterval(e)}}),[D]);var V=Object(i.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c&&0!==c.length){e.next=4;break}return M({title:"Unable to join town",description:"Please select a username",status:"error"}),e.abrupt("return");case 4:if(t&&0!==t.length){e.next=7;break}return M({title:"Unable to join town",description:"Please enter a town ID",status:"error"}),e.abrupt("return");case 7:return e.next=9,L.setup(c,t);case 9:return r=e.sent,e.next=12,n(r);case 12:if(!e.sent){e.next=17;break}return v()(r.providerVideoToken),e.next=17,N(r.providerVideoToken);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),M({title:"Unable to connect to Towns Service",description:e.t0.toString(),status:"error"});case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),[n,c,N,M]),A=function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c&&0!==c.length){e.next=3;break}return M({title:"Unable to create town",description:"Please select a username before creating a town",status:"error"}),e.abrupt("return");case 3:if(j&&0!==j.length){e.next=6;break}return M({title:"Unable to create town",description:"Please enter a town name",status:"error"}),e.abrupt("return");case 6:return e.prev=6,e.next=9,I.createTown({friendlyName:j,isPubliclyListed:O});case 9:return t=e.sent,n=Object(r.jsx)(r.Fragment,{}),O||(n=Object(r.jsxs)("p",{children:["This town will NOT be publicly listed. To re-enter it, you will need to use this ID: ",t.coveyTownID]})),M({title:"Town ".concat(j," is ready to go!"),description:Object(r.jsxs)(r.Fragment,{children:[n,"Please record these values in case you need to change the room:",Object(r.jsx)("br",{}),"Town ID: ",t.coveyTownID,Object(r.jsx)("br",{}),"Town Editing Password: ",t.coveyTownPassword]}),status:"success",isClosable:!0,duration:null}),e.next=15,V(t.coveyTownID);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),M({title:"Unable to connect to Towns Service",description:e.t0.toString(),status:"error"});case 20:case"end":return e.stop()}}),e,null,[[6,17]])})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("form",{children:Object(r.jsxs)(Fn.a,{children:[Object(r.jsxs)(Rn.a,{p:"4",borderWidth:"1px",borderRadius:"lg",children:[Object(r.jsx)(jn.a,{as:"h2",size:"lg",children:"Select a username"}),Object(r.jsxs)(Ht.a,{children:[Object(r.jsx)(Wt.a,{htmlFor:"name",children:"Name"}),Object(r.jsx)(Kt.a,{autoFocus:!0,name:"name",placeholder:"Your name",value:c,onChange:function(e){return s(e.target.value)}})]})]}),Object(r.jsxs)(Rn.a,{borderWidth:"1px",borderRadius:"lg",children:[Object(r.jsx)(jn.a,{p:"4",as:"h2",size:"lg",children:"Create a New Town"}),Object(r.jsxs)(Bn.a,{p:"4",children:[Object(r.jsx)(Rn.a,{flex:"1",children:Object(r.jsxs)(Ht.a,{children:[Object(r.jsx)(Wt.a,{htmlFor:"townName",children:"New Town Name"}),Object(r.jsx)(Kt.a,{name:"townName",placeholder:"New Town Name",value:j,onChange:function(e){return f(e.target.value)}})]})}),Object(r.jsx)(Rn.a,{children:Object(r.jsxs)(Ht.a,{children:[Object(r.jsx)(Wt.a,{htmlFor:"isPublic",children:"Publicly Listed"}),Object(r.jsx)(Ut.a,{id:"isPublic",name:"isPublic",isChecked:O,onChange:function(e){x(e.target.checked)}})]})}),Object(r.jsx)(Rn.a,{children:Object(r.jsx)(Gt.a,{"data-testid":"newTownButton",onClick:A,children:"Create"})})]})]}),Object(r.jsx)(jn.a,{p:"4",as:"h2",size:"lg",children:"-or-"}),Object(r.jsxs)(Rn.a,{borderWidth:"1px",borderRadius:"lg",children:[Object(r.jsx)(jn.a,{p:"4",as:"h2",size:"lg",children:"Join an Existing Town"}),Object(r.jsx)(Rn.a,{borderWidth:"1px",borderRadius:"lg",children:Object(r.jsxs)(Bn.a,{p:"4",children:[Object(r.jsxs)(Ht.a,{children:[Object(r.jsx)(Wt.a,{htmlFor:"townIDToJoin",children:"Town ID"}),Object(r.jsx)(Kt.a,{name:"townIDToJoin",placeholder:"ID of town to join, or select from list",value:y,onChange:function(e){return k(e.target.value)}})]}),Object(r.jsx)(Gt.a,{"data-testid":"joinTownByIDButton",onClick:function(){return V(y)},children:"Connect"})]})}),Object(r.jsx)(jn.a,{p:"4",as:"h4",size:"md",children:"Select a public town to join"}),Object(r.jsx)(Rn.a,{maxH:"500px",overflowY:"scroll",children:Object(r.jsxs)(zn.a,{children:[Object(r.jsx)(zn.b,{placement:"bottom",children:"Publicly Listed Towns"}),Object(r.jsx)(zn.f,{children:Object(r.jsxs)(zn.g,{children:[Object(r.jsx)(zn.e,{children:"Room Name"}),Object(r.jsx)(zn.e,{children:"Room ID"}),Object(r.jsx)(zn.e,{children:"Activity"})]})}),Object(r.jsx)(zn.c,{children:null===T||void 0===T?void 0:T.map((function(e){return Object(r.jsxs)(zn.g,{children:[Object(r.jsx)(zn.d,{role:"cell",children:e.friendlyName}),Object(r.jsx)(zn.d,{role:"cell",children:e.coveyTownID}),Object(r.jsxs)(zn.d,{role:"cell",children:[e.currentOccupancy,"/",e.maximumOccupancy,Object(r.jsx)(Gt.a,{onClick:function(){return V(e.coveyTownID)},disabled:e.currentOccupancy>=e.maximumOccupancy,children:"Connect"})]})]},e.coveyTownID)}))})]})})]})]})})})}function Hn(e){return Object(r.jsxs)(An,{children:[Object(r.jsx)(jn.a,{as:"h2",size:"xl",children:"Welcome to Covey.Town!"}),Object(r.jsx)(fn.a,{p:"4",children:"Covey.Town is a social platform that integrates a 2D game-like metaphor with video chat. To get started, setup your camera and microphone, choose a username, and then create a new town to hang out in, or join an existing one."}),Object(r.jsx)(Dn,{setMediaError:e.setMediaError}),Object(r.jsx)(_n,{doLogin:e.doLogin})]})}function Wn(e){var t=e.doLogin,n=Object(i.useState)(),a=Object(d.a)(n,2),o=a[0],c=a[1];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(dn,{error:o,dismissError:function(){return c(void 0)}}),Object(r.jsx)(Hn,{doLogin:t,setMediaError:c})]})}function Kn(){var e,t=ge(),n=t.roomType,r=t.settings,i={bandwidthProfile:{video:{mode:"grid",dominantSpeakerPriority:r.dominantSpeakerPriority,renderDimensions:{low:{width:176,height:144},standard:{width:320,height:240},high:{width:1280,height:720}},maxTracks:Number(r.maxTracks)}},dominantSpeaker:!0,networkQuality:{local:1,remote:1},maxAudioBitrate:Number(r.maxAudioBitrate),preferredVideoCodecs:[{codec:"VP8",simulcast:"peer-to-peer"!==n&&"go"!==n}]};return je&&(null===i||void 0===i||null===(e=i.bandwidthProfile)||void 0===e?void 0:e.video)&&(i.bandwidthProfile.video.maxSubscriptionBitrate=25e5),fe(i)}var Un=n(540),Gn=n(523),Yn=n(541),qn=Object(F.a)({container:{marginTop:"2.5em"},paper:{padding:"1em"},heading:{marginBottom:"0.4em"}}),Jn=function(e){var t=e.children,n=qn();return Ve.a.isSupported?t:Object(r.jsx)(Un.a,{children:Object(r.jsx)(ct.a,{container:!0,justify:"center",className:n.container,children:Object(r.jsx)(ct.a,{item:!0,xs:12,sm:6,children:Object(r.jsxs)(Gn.a,{className:n.paper,children:[Object(r.jsx)(z.a,{variant:"h4",className:n.heading,children:"Browser or context not supported"}),Object(r.jsxs)(z.a,{children:["Please open this application in one of the"," ",Object(r.jsx)(Yn.a,{href:"https://www.twilio.com/docs/video/javascript#supported-browsers",target:"_blank",rel:"noopener",children:"supported browsers"}),".",Object(r.jsx)("br",{}),"If you are using a supported browser, please ensure that this app is served over a"," ",Object(r.jsx)(Yn.a,{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener",children:"secure context"})," ","(e.g. https or localhost)."]})]})})})})},Qn=n(542);var Xn=function(e){var t=e.dismissError,n=e.error,i=n||{},a=i.message,o=i.code,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(arguments.length>1?arguments[1]:void 0){case 20101:return"".concat(e,". Please make sure you are using the correct credentials.");default:return e}}(a,o);return Object(r.jsxs)(ft.a,{open:null!==n,onClose:function(){return t()},fullWidth:!0,maxWidth:"xs",children:[Object(r.jsx)(pt.a,{children:"ERROR"}),Object(r.jsxs)(mt.a,{children:[Object(r.jsx)(Qn.a,{children:c}),Boolean(o)&&Object(r.jsx)("pre",{children:Object(r.jsxs)("code",{children:["Error Code:",o]})})]}),Object(r.jsx)(Ot.a,{children:Object(r.jsx)(ot.a,{onClick:function(){return t()},color:"primary",autoFocus:!0,children:"OK"})})]})},Zn=n(272),$n=Object(Zn.a)();function er(){return{nearbyPlayers:{nearbyPlayers:[]},players:[],myPlayerID:"",currentTownFriendlyName:"",currentTownID:"",currentTownIsPubliclyListed:!1,sessionToken:"",userName:"",socket:null,currentLocation:{x:0,y:0,rotation:"front",moving:!1},emitMovement:function(){},apiClient:new P}}function tr(e,t){var n,r,i={sessionToken:e.sessionToken,currentTownFriendlyName:e.currentTownFriendlyName,currentTownID:e.currentTownID,currentTownIsPubliclyListed:e.currentTownIsPubliclyListed,myPlayerID:e.myPlayerID,players:e.players,currentLocation:e.currentLocation,nearbyPlayers:e.nearbyPlayers,userName:e.userName,socket:e.socket,emitMovement:e.emitMovement,apiClient:e.apiClient};function a(e,t){return{nearbyPlayers:e.filter((function(e){return function(e,t){if(e.location&&t){var n=e.location.x-t.x,r=e.location.y-t.y;return Math.sqrt(n*n+r*r)<80}return!1}(e,t)}))}}function o(e,t){if(e.nearbyPlayers.length!==t.nearbyPlayers.length)return!1;var n=e.nearbyPlayers.map((function(e){return e.id})).sort(),r=t.nearbyPlayers.map((function(e){return e.id})).sort();return!n.some((function(e,t){return e!==r[t]}))}switch(t.action){case"doConnect":i.sessionToken=t.data.sessionToken,i.myPlayerID=t.data.myPlayerID,i.currentTownFriendlyName=t.data.townFriendlyName,i.currentTownID=t.data.townID,i.currentTownIsPubliclyListed=t.data.townIsPubliclyListed,i.userName=t.data.userName,i.emitMovement=t.data.emitMovement,i.socket=t.data.socket,i.players=t.data.players;break;case"addPlayer":i.players=i.players.concat([t.player]);break;case"playerMoved":(r=i.players.find((function(e){return e.id===t.player.id})))?r.location=t.player.location:i.players=i.players.concat([t.player]),i.nearbyPlayers=a(i.players,i.currentLocation),o(i.nearbyPlayers,e.nearbyPlayers)&&(i.nearbyPlayers=e.nearbyPlayers);break;case"weMoved":i.currentLocation=t.location,i.nearbyPlayers=a(i.players,i.currentLocation),o(i.nearbyPlayers,e.nearbyPlayers)&&(i.nearbyPlayers=e.nearbyPlayers);break;case"playerDisconnect":i.players=i.players.filter((function(e){return e.id!==t.player.id})),i.nearbyPlayers=a(i.players,i.currentLocation),o(i.nearbyPlayers,e.nearbyPlayers)&&(i.nearbyPlayers=e.nearbyPlayers);break;case"disconnect":return null===(n=e.socket)||void 0===n||n.disconnect(),er();default:throw new Error("Unexpected state request")}return i}function nr(e,t){return rr.apply(this,arguments)}function rr(){return(rr=Object(u.a)(l.a.mark((function e(t,n){var r,i,a,o,c,s,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.coveyUserID,i=t.coveySessionToken,a=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_TOWNS_SERVICE_URL,v()(a),o=L.instance(),v()(o),c=o.townFriendlyName,v()(c),(s=Object(h.io)(a,{auth:{token:i,coveyTownID:o.coveyTownID}})).on("newPlayer",(function(e){n({action:"addPlayer",player:k.fromServerPlayer(e)})})),s.on("playerMoved",(function(e){e._id!==r&&n({action:"playerMoved",player:k.fromServerPlayer(e)})})),s.on("playerDisconnect",(function(e){n({action:"playerDisconnect",player:k.fromServerPlayer(e)})})),s.on("disconnect",(function(){n({action:"disconnect"})})),d=function(e){s.emit("playerMovement",e),n({action:"weMoved",location:e})},n({action:"doConnect",data:{sessionToken:i,userName:o.userName,townFriendlyName:c,townID:o.coveyTownID,myPlayerID:r,townIsPubliclyListed:o.isPubliclyListed,emitMovement:d,socket:s,players:t.currentPlayers.map((function(e){return k.fromServerPlayer(e)}))}}),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ir(e){var t=Object(i.useReducer)(tr,er()),n=Object(d.a)(t,2),a=n[0],o=n[1],c=Object(i.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nr(t,o);case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o]),s=L.instance(),b=e.setOnDisconnect;Object(i.useEffect)((function(){b((function(){return Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o({action:"disconnect"}),e.abrupt("return",L.teardown());case 2:case"end":return e.stop()}}),e)})))}))}),[o,b]);var h=Object(i.useMemo)((function(){return a.sessionToken?s?Object(r.jsxs)("div",{children:[Object(r.jsx)(M,{}),Object(r.jsx)(hn,{preferredMode:"fullwidth"})]}):Object(r.jsx)("div",{children:"Loading..."}):Object(r.jsx)(Wn,{doLogin:c})}),[c,a.sessionToken,s]);return Object(r.jsx)(N.Provider,{value:a,children:Object(r.jsx)(Yt.Provider,{value:L.instance(),children:Object(r.jsx)($e.Provider,{value:a.nearbyPlayers,children:h})})})}function ar(){var e=ge(),t=e.error,n=e.setError,a=Object(i.useState)(),o=Object(d.a)(a,2),c=o[0],s=o[1],l=Kn();return Object(r.jsx)(Jn,{children:Object(r.jsxs)(Qe,{options:l,onError:n,onDisconnect:c,children:[Object(r.jsx)(Xn,{dismissError:function(){return n(null)},error:t}),Object(r.jsx)(ir,{setOnDisconnect:s})]})})}function or(){return Object(r.jsx)(b.a,{children:Object(r.jsx)(j.a,{children:Object(r.jsx)(f.a,{theme:(e="rgb(185, 37, 0)",Object(Zn.a)({overrides:{MuiButton:{root:{borderRadius:"4px",textTransform:"none",color:"rgb(40, 42, 43)",fontSize:"0.9rem",transition:$n.transitions.create(["background-color","box-shadow","border","color"],{duration:$n.transitions.duration.short})},text:{padding:"6px 14px"},contained:{boxShadow:"none","&:hover":{boxShadow:"none"}},outlinedPrimary:{border:"2px solid #027AC5","&:hover":{border:"2px solid rgb(1, 85, 137)"}},startIcon:{marginRight:"6px"}},MuiTypography:{body1:{color:"rgb(40, 42, 43)",fontSize:"0.9rem"}},MuiInputBase:{root:{fontSize:"0.9rem"}},MuiSelect:{root:{padding:"0.85em"}},MuiDialogActions:{root:{padding:"16px"}},MuiTextField:{root:{color:"rgb(40, 42, 43)"}},MuiInputLabel:{root:{color:"rgb(40, 42, 43)",fontSize:"1.1rem",marginBottom:"0.2em",fontWeight:500}},MuiOutlinedInput:{notchedOutline:{borderColor:"rgb(136, 140, 142)"}}},breakpoints:{values:{xs:0,sm:640,md:768,lg:1024,xl:1280}},typography:{fontFamily:"Inter, sans-serif"},palette:{primary:{main:e}},brand:e,footerHeight:72,mobileFooterHeight:56,sidebarWidth:355,sidebarMobileHeight:90,mobileTopBarHeight:52})),children:Object(r.jsx)(xe,{preferredMode:"fullwidth",highlightedProfiles:[],children:Object(r.jsx)(ar,{})})})})});var e}var cr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,564)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),a(e),o(e)}))};c.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(or,{})}),document.getElementById("root")),cr()}},[[466,1,2]]]);
//# sourceMappingURL=main.8da17706.chunk.js.map